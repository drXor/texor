% (c) 2015 Miguel Young
%
%% This program can be redistributed and/or modified under the terms
%% of the LaTeX Project Public License Distributed from CTAN archives
%% in directory macros/latex/base/lppl.txt.
% 
\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{texor}
  [2015/01/01 v1.0 teXor LaTeX Suite]

\let\h@rpoon\rightharpoonup

%%% IMPORTS %%%
\RequirePackage{amsthm}
\RequirePackage{verbatim}
\RequirePackage{bm}
\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{amsfonts}
\RequirePackage{scalerel}
\RequirePackage{ifthen}
\RequirePackage{xstring}
\RequirePackage{graphicx}
\RequirePackage{mathalfa}
\RequirePackage{accsupp}
\RequirePackage{verbatim}
\RequirePackage{xcolor}
\RequirePackage{esint}
\RequirePackage{mathtools}
\RequirePackage{xparse}
\RequirePackage{mathrsfs}
\RequirePackage{accents}
\RequirePackage{tikz}
\RequirePackage{tikz-cd}
\RequirePackage{enumitem}
\RequirePackage{siunitx}
\RequirePackage{cancel}
%\RequirePackage{gensymb}
%%% IMPORTS %%%

%%% FONT STUFF %%%
\def\amsbb{\use@mathgroup \M@U \symAMSb}

\RequirePackage[no-math]{fontspec}
\RequirePackage{xunicode}
\newfontfamily\xitsbb{XITS Math}

\RequirePackage{bbold}
\let\bbold\mathbb

\let\amscal\mathcal
\DeclareMathAlphabet{\othercal}{OT1}{pzc}{m}{it}

\usepackage{bm}
\def\mathbf#1{\bm{\mathrm{#1}}}
%%% FONT STUFF %%%

\newcommand{\TeXoR}
    {\TeX \hspace{-0.875ex}{\raisebox{0.31ex}{o}}\hspace{-0.55ex}R}

\def\@x@{}
\newcommand{\@exists}[3]{\ifx\@x@#1\@x@ #3 \else #2 \fi}

%%% Preamble %%%
\newcommand{\smallmargins}{\geometry{lmargin=1in,rmargin=1in}}

\newcommand{\resetmargins}{\geometry{lmargin=2in,rmargin=2in}}

\newcommand{\call}[1]{\csname#1\endcsname}

\def\changemargin#1#2{\list{}{\rightmargin#2\leftmargin#1}\item[]}
\let\endchangemargin=\endlist

\newcommand{\oset}[3][0ex]{%
  {\mathop{#3}\limits^{
    \vbox to#1{\kern-2\ex@
    \hbox{$#2$}\vss}}}}
    
\let\esi\si
\let\si\relax

%%% Theorems %%%

\let\defaultqed\qedsymbol

% shorthand for theorem generation
\newcommand{\mkthm@}[2]{%
    \newtheorem{S#1}{#2}[section]
    \newtheorem{#1}{#2}
    \newtheorem*{#1*}{#2}
}

\def\deqsymbol{$\smashtimes$}
\newenvironment{proof*}[1][Proof]
    {\begin{proof}[#1]\def\qedsymbol{\deqsymbol}}
    {\end{proof}\def\deqsymbol{$\smashtimes$}}

\newcommand{\mkprf@}[3][]{%
    \newenvironment{#2}
        {\begin{proof}[#3] \@exists{#1}{\def\qedsymbol{#1}}{}}
        {\end{proof}}
}

\newcommand{\mkcontr@}[3][]{%
    \newenvironment{#2}
        {\begin{proof*}[#3] \@exists{#1}{\def\deqsymbol{#1}}{}}
        {\end{proof*}}
}

\mkthm@{thm}{Theorem}
\mkthm@{lem}{Lemma}
\mkthm@{prop}{Proposition}
\mkthm@{cor}{Corollary}

\theoremstyle{definition}

\mkthm@{defn}{Definition}
\mkthm@{axi}{Axiom}
\mkthm@{conj}{Conjecture}
\mkthm@{example}{Example}
\mkthm@{exercise}{Exercise}
\mkthm@{prob}{Problem}
\mkthm@{fact}{Fact}

\theoremstyle{remark}

\mkthm@{rem}{Remark}
\mkthm@{note}{Note}
\mkthm@{notation}{Notation}
  
\mkprf@{solution}{Solution}

\begin{comment}
\newenvironment{casework}
{%
    \begingroup%
    \newcounter{casei}% 
    \newcommand{\case}[1][]{%
    \\ Case. %\stepcounter{casei}\\ \noindent Case \exists{#1}{#1}{\arabic{casei}.%
    }%
    \hfill \\%
}
{\endgroup}
\end{comment}

\newlist{casework}{enumerate}{10}
\setlist[casework]{label=\emph{Case \arabic*.}, leftmargin=5em}

% TODO: fix, probably with tikz
\let\qed@symbol\qedsymbol
\newcommand{\useHappyQED}{%
    \renewcommand{\qedsymbol}{:)}
    \renewcommand{\deqsymbol}{:(}
}

\newcommand{\resetQED}{%
    \renewcommand{\qedsymbol}{$\qed@symbol$}
    \renewcommand{\deqsymbol}{$\smashtimes$}
}

%%% Variables %%%

\def\xhar{\xitsbb\char}
\newcommand{\tobb}[1]{%
\ifthenelse{\equal{#1}{a}}{\xhar"1D552}{%
\ifthenelse{\equal{#1}{b}}{\xhar"1D553}{%
\ifthenelse{\equal{#1}{c}}{\xhar"1D554}{%
\ifthenelse{\equal{#1}{d}}{\xhar"1D555}{%
\ifthenelse{\equal{#1}{e}}{\xhar"1D556}{%
\ifthenelse{\equal{#1}{f}}{\xhar"1D557}{%
\ifthenelse{\equal{#1}{g}}{\xhar"1D558}{%
\ifthenelse{\equal{#1}{h}}{\xhar"1D559}{%
\ifthenelse{\equal{#1}{i}}{\xhar"1D55A}{%
\ifthenelse{\equal{#1}{j}}{\xhar"1D55B}{%
\ifthenelse{\equal{#1}{k}}{\xhar"1D55C}{%
\ifthenelse{\equal{#1}{l}}{\xhar"1D55D}{%
\ifthenelse{\equal{#1}{m}}{\xhar"1D55E}{%
\ifthenelse{\equal{#1}{n}}{\xhar"1D55F}{%
\ifthenelse{\equal{#1}{o}}{\xhar"1D560}{%
\ifthenelse{\equal{#1}{p}}{\xhar"1D561}{%
\ifthenelse{\equal{#1}{q}}{\xhar"1D562}{%
\ifthenelse{\equal{#1}{r}}{\xhar"1D563}{%
\ifthenelse{\equal{#1}{s}}{\xhar"1D564}{%
\ifthenelse{\equal{#1}{t}}{\xhar"1D565}{%
\ifthenelse{\equal{#1}{u}}{\xhar"1D566}{%
\ifthenelse{\equal{#1}{v}}{\xhar"1D567}{%
\ifthenelse{\equal{#1}{w}}{\xhar"1D568}{%
\ifthenelse{\equal{#1}{x}}{\xhar"1D569}{%
\ifthenelse{\equal{#1}{y}}{\xhar"1D56A}{%
\ifthenelse{\equal{#1}{z}}{\xhar"1D56B}{%
%
\ifthenelse{\equal{#1}{0}}{\xhar"1D7D8}{%
%\ifthenelse{\equal{#1}{1}}{\xhar"1D7D9}{%
\ifthenelse{\equal{#1}{2}}{\xhar"1D7DA}{%
\ifthenelse{\equal{#1}{3}}{\xhar"1D7DB}{%
\ifthenelse{\equal{#1}{4}}{\xhar"1D7DC}{%
\ifthenelse{\equal{#1}{5}}{\xhar"1D7DD}{%
\ifthenelse{\equal{#1}{6}}{\xhar"1D7DE}{%
%\ifthenelse{\equal{#1}{7}}{\xhar"1D7DF}{%
\ifthenelse{\equal{#1}{8}}{\xhar"1D7E0}{%
\ifthenelse{\equal{#1}{9}}{\xhar"1D7E1}{%
%
\ifthenelse{\equal{#1}{\pi}}{\xhar"0213C}{%
\ifthenelse{\equal{#1}{\gamma}}{\xhar"0213D}{%
\ifthenelse{\equal{#1}{\Gamma}}{\xhar"0213E}{%
\ifthenelse{\equal{#1}{\Pi}}{\xhar"0213F}{%
$\bbold{#1}$%
}}}}%
}}}}}}}}}}%
}}}}}}}}}}}}}}}}}}}}}}}}%}%}%
}

\newcommand{\otherbb}[1]{\text{\tobb{#1}}}

%\def\othercal#1{\vstretch{1.2}{\hstretch{1.2}{\pzccal{#1}}}}

% Magic for mathbb/mathcal %
\newcommand{\ifCap}[3]{{\ifthenelse{
    \equal{#1}{A} \OR \equal{#1}{B} \OR \equal{#1}{C} \OR \equal{#1}{D} \OR
    \equal{#1}{E} \OR \equal{#1}{F} \OR \equal{#1}{G} \OR \equal{#1}{H} \OR
    \equal{#1}{I} \OR \equal{#1}{J} \OR \equal{#1}{K} \OR \equal{#1}{L} \OR
    \equal{#1}{M} \OR \equal{#1}{N} \OR \equal{#1}{O} \OR \equal{#1}{P} \OR
    \equal{#1}{Q} \OR \equal{#1}{R} \OR \equal{#1}{S} \OR \equal{#1}{T} \OR
    \equal{#1}{U} \OR \equal{#1}{V} \OR \equal{#1}{W} \OR \equal{#1}{X} \OR
    \equal{#1}{Y} \OR \equal{#1}{Z}
}{\call{#2}{#1}}{\call{#3}{#1}}}}

\def\bbouter#1{\bbloop#1\relax}
\def\bbloop#1{\ifx\relax#1\else\ifCap{#1}{amsbb}{otherbb}\expandafter\bbloop\fi}
\def\mathbb#1{\expandafter\bbouter\expandafter{#1}}

\def\calouter#1{\calloop#1\relax}
\def\calloop#1{\ifx\relax#1\else\ifCap{#1}{amscal}{othercal}\expandafter\calloop\fi}
\def\mathcal#1{\expandafter\calouter\expandafter{#1}}
% End Magic %

%% Formats %%
%def\vec#1{\oset[-1.8pt]{\hstretch{0.7}{\mathbf{\scriptscriptstyle\h@rpoon}}}{#1}}
%\usepackage{harpoon}
%\newcommand*{\vec}[1]{\text{\overharp{\vstretch{0.4}{\scriptscriptstyle\h@rpoon}}{\ensuremath{#1}}{.7}}} 
%\def\vec\rharp
%#1{\overset{\scriptscriptstyle\h@rpoon}{\vphantom{a}{#1}}}
\newcommand{\idcommand}[1]{#1}
\newcommand{\ivect}{\bm}
\newcommand{\vect}[1]{{\mathbf{#1}}}
\newcommand{\ihatt}[1]{\hat{\bm{#1}}}
\newcommand{\hatt}[1]{\mathbf{\hat{#1}}}
\newcommand{\veca}[1]{\vec{\mathbf{#1}}}
\newcommand{\cat}{\mathcal}
\newcommand{\namedCat}{\mathbf}
\newcommand{\fld}{\mathbb}
\newcommand{\lie}{\mathfrak}
\newcommand{\rmn}{\mathrm}
\newcommand{\unit}[1]{\,\rmn{#1}}

\newcommand{\usevec}{
    \renewcommand{\vect}{\vec}
    \renewcommand{\hatt}[1]{\hat{##1}}
    \def\vnabla{\vec{\nabla}}
   
}
\newcommand{\useveca}{
    \renewcommand{\vect}{\veca}
    \def\vnabla{\vec{\nabla}}
}
\newcommand{\usevect}{
    \renewcommand{\vect}{\mathbf} 
    \renewcommand{\hatt}[1]{\hat{\mathbf{##1}}}
    \def\vnabla{\nabla}
}

\def\mkletter@#1#2#3{%
    \expandafter\providecommand\csname#2#1\endcsname
        {\csname#3\endcsname{#1}}
}
% \@mkalph{prefix}{command}
\def\mkalph@#1#2{%
    \mkletter@{a}{#1}{#2} \mkletter@{j}{#1}{#2} \mkletter@{s}{#1}{#2}
    \mkletter@{b}{#1}{#2} \mkletter@{k}{#1}{#2} \mkletter@{t}{#1}{#2}
    \mkletter@{c}{#1}{#2} \mkletter@{l}{#1}{#2} \mkletter@{u}{#1}{#2}
    \mkletter@{d}{#1}{#2} \mkletter@{m}{#1}{#2} \mkletter@{v}{#1}{#2}
    \mkletter@{e}{#1}{#2} \mkletter@{n}{#1}{#2} \mkletter@{w}{#1}{#2}
    \mkletter@{f}{#1}{#2} \mkletter@{o}{#1}{#2} \mkletter@{x}{#1}{#2}
    \mkletter@{g}{#1}{#2} \mkletter@{p}{#1}{#2} \mkletter@{y}{#1}{#2}
    \mkletter@{h}{#1}{#2} \mkletter@{q}{#1}{#2} \mkletter@{z}{#1}{#2}
    \mkletter@{i}{#1}{#2} \mkletter@{r}{#1}{#2}
    
    \mkletter@{A}{#1}{#2} \mkletter@{J}{#1}{#2} \mkletter@{S}{#1}{#2}
    \mkletter@{B}{#1}{#2} \mkletter@{K}{#1}{#2} \mkletter@{T}{#1}{#2}
    \mkletter@{C}{#1}{#2} \mkletter@{L}{#1}{#2} \mkletter@{U}{#1}{#2}
    \mkletter@{D}{#1}{#2} \mkletter@{M}{#1}{#2} \mkletter@{V}{#1}{#2}
    \mkletter@{E}{#1}{#2} \mkletter@{N}{#1}{#2} \mkletter@{W}{#1}{#2}
    \mkletter@{F}{#1}{#2} \mkletter@{O}{#1}{#2} \mkletter@{X}{#1}{#2}
    \mkletter@{G}{#1}{#2} \mkletter@{P}{#1}{#2} \mkletter@{Y}{#1}{#2}
    \mkletter@{H}{#1}{#2} \mkletter@{Q}{#1}{#2} \mkletter@{Z}{#1}{#2}
    \mkletter@{I}{#1}{#2} \mkletter@{R}{#1}{#2}
}

%% Shorthands %%
\newcommand{\vl}{\vect{\ell}}
\newcommand{\vii}{\bm{\textnormal{\bfseries\i}}}
\newcommand{\vjj}{\bm{\textnormal{\bfseries\j}}}
\newcommand{\hi}{\hat{\vii}}
\newcommand{\hj}{\hat{\vjj}}
\newcommand{\Hi}{\hat{\vii}}
\newcommand{\Hj}{\hat{\vjj}}
\newcommand{\fii}{\fld{i}}

\newcommand{\vzero}{\vect{0}}
\newcommand{\vone}{\vect{1}}
\newcommand{\vtwo}{\vect{2}}
\newcommand{\vthree}{\vect{3}}
\newcommand{\vfour}{\vect{4}}
\newcommand{\vfive}{\vect{5}}

\mkalph@{v}{vect} % vectors
\mkalph@{h}{hat} % hactors
\mkalph@{H}{hatt} % hactors
\mkalph@{iv}{ivect} % italic vectors
\mkalph@{iH}{ihatt} % italic hactors
\mkalph@{L}{lie}  % fracktur (lie)
\mkalph@{C}{cat}  % calligraphy
\mkalph@{f}{fld}  % black board
 
% Greek %
\newcommand{\al}{\alpha}
\newcommand{\be}{\beta}
\newcommand{\ga}{\gamma}
\newcommand{\de}{\delta}
\newcommand{\la}{\lambda}
\newcommand{\te}{\theta}
\newcommand{\ka}{\kappa}
\newcommand{\si}{\sigma}
\newcommand{\om}{\omega}
\newcommand{\ze}{\zeta}
\newcommand{\ep}{\varepsilon}
\newcommand{\ph}{\varphi}
\newcommand{\ps}{\psi}
\newcommand{\ups}{\upsilon}

\newcommand{\vte}{\vartheta}
\newcommand{\vka}{\varkappa}
\newcommand{\vsi}{\varsigma}
\newcommand{\vep}{\epsilon}
\newcommand{\vps}{\varpsi}
\newcommand{\vrho}{\varrho}
\newcommand{\vpi}{\varpi}

\newcommand{\Ga}{\Gamma}
\newcommand{\De}{{\mathchoice
    {\hstretch{0.8}{\Delta}}
    {\hstretch{0.8}{\Delta}}
    {\hstretch{0.7}{\Delta}}
    {\hstretch{0.7}{\Delta}}}}
\newcommand{\Te}{\Theta}
\newcommand{\lla}{\Lambda}
\newcommand{\LLa}{\Lambda}
\newcommand{\Si}{\Sigma}
\newcommand{\Om}{\Omega}
\newcommand{\Ph}{\Phi}
\newcommand{\Ps}{\Psi}
\newcommand{\Ups}{\Upsilon}

\newcommand{\vGa}{\varGamma}
\newcommand{\vDe}{{\mathchoice
    {\hstretch{0.8}{\varDelta}}
    {\hstretch{0.8}{\varDelta}}
    {\hstretch{0.7}{\varDelta}}
    {\hstretch{0.7}{\varDelta}}}}
\newcommand{\vlla}{\varLambda}
\newcommand{\vTe}{\varTheta}
\newcommand{\vSi}{\varSigma}
\newcommand{\vOm}{\varOmega}
\newcommand{\vPs}{\varPsi}
\newcommand{\vXi}{\varXi}
\newcommand{\vPh}{\varPhi}
\newcommand{\vPi}{\varPi}

\let\bignabla\nabla
\def\nabla{{\mathchoice
    {\hstretch{0.8}{\bignabla}}
    {\hstretch{0.8}{\bignabla}}
    {\hstretch{0.7}{\bignabla}}
    {\hstretch{0.7}{\bignabla}}}}
\def\vnabla{\nabla}

% Misc %
\newcommand{\eset}{\varnothing}

\newcommand{\ii}{\imath}
\newcommand{\jj}{\jmath}

%% Common Variables %%

\let\pilcrow\P

% Number Systems %
\newcommand{\F}{\fF} % finite field
\newcommand{\N}{\fN} % natural numbers
\newcommand{\Z}{\fZ} % integers
\newcommand{\Q}{\fQ} % rational numbers
\newcommand{\R}{\fR} % real numbers
\newcommand{\C}{\fC} % complex numbers
\renewcommand{\P}{\fP} % PROJECTIVE SPACE!!!

\newcommand{\newspgrp}[2]{
    \expandafter\DeclareDocumentCommand\csname#1\endcsname{ O{} m }{\mathrm{#2}_{##1}\@exists{##2}{\Par{##2}}{}}
}

\newspgrp{GL}{GL}
\newspgrp{SL}{SL}
\newspgrp{SO}{SO}
\newspgrp{sO}{O}
\newspgrp{SU}{SU}
\newspgrp{sU}{U}

% Categories %

\newcommand{\newcat}[2][c]{
    \expandafter\newcommand\csname #1#2\endcsname{
        {\namedCat{#2}}
    }
}
\newcommand{\newlcat}[2][cl]{
    \expandafter\newcommand\csname #1#2\endcsname[1][]{
        {\@exists{##1}{##1\text{-}}{}\namedCat{#2}}
    }
}
\newcommand{\newrcat}[2][cr]{
    \expandafter\newcommand\csname #1#2\endcsname[1][]{
        {\namedCat{#2}\@exists{##1}{\text{-}##1}{}}
    }
}
\newcommand{\newlrcat}[2][clr]{
    \expandafter\DeclareDocumentCommand\csname #1#2\endcsname{ O{} O{} }{
        {\@exists{##1}{##1\text{-}}{}\namedCat{#2}\@exists{##2}{\text{-}##2}{}}
    }
}
\newcommand{\newvcat}[2][cv]{
    \expandafter\newcommand\csname #1#2\endcsname[1][]{
        {\namedCat{#2}_{##1}}
    }
}
\newcommand{\newvlcat}[2][cvl]{
    \expandafter\DeclareDocumentCommand\csname #1#2\endcsname{ O{} O{} }{
        {\@exists{##1}{##1\text{-}}{}\namedCat{#2}_{##2}}
    }
}
\newcommand{\newpcat}[2][cp]{
    \expandafter\newcommand\csname #1#2\endcsname[1][]{
        {\namedCat{#2}\Par{##1}}
    }
}

% Cats: Sets
\newcat{Set}        % sets / functions
\newcat{Cls}        % classes / functions
\newcat{Ens}        % ensambles / functions
\newcat{Fin}        % finite sets / functions
\newcat{Finord}     % finite ordinals / order-preserving functions
\newcat{Ord}        % ordered sets / order-preserving maps
\newcat{Rel}        % relations / relation-preserving maps

% Cats: Grps %
\newcat{Mon}        % monoids / homomorphisms
\newcat{Grp}        % groups / homomorphisms
\newcat{Ab}         % abelian groups / homomorphisms
\newcat{Rig}        % rigs / homomorphisms
\newcat{Rng}        % rngs / homomorphisms
\newcat{Ring}       % rings / homomorphisms
\newcat{CRng}       % commutative rngs / homomorphisms
\newcat{CRing}      % commutative rings / homomorphisms
\newcat{Dom}        % integral domains / homomorphisms
\newcat{Fld}        % fields / homomorphisms

\newlrcat[c]{Mod}   % two-sided modules / linear maps
\newrcat{Mod}       % right modules / linear maps
\newlrcat[c]{GMod}  % graded modules / linear maps
\newlrcat[c]{DGMod} % differential graded modules
\newvcat[c]{Alg}    % algebras / homomorphisms
\newvcat[c]{CAlg}   % commutative algebras / homomorphisms
\newvcat[c]{Rep}    % representations / intertwiners
\newvlcat[cv]{Rep}  % " / " (w/ subscript)
\newvcat[c]{Vct}    % vector spaces / linear maps
\newvcat[c]{Vect}   % " / "

% Cats: Calc %
\newcat{Met}        % metric spaces / metric-preserving maps
\newcat{CMet}       % complete metric spaces / metric-preserving functions
\newcat{Hil}        % Hilbert spaces
\newcat{Ban}        % Banach spaces
\newcat{Lie}        % Lie groups/algebras
\newcat{Man}        % manifolds
\newcat{DMan}       % differentiable manifolds
\newcat{SMan}       % smooth manifolds

% Cats: Cats %
\newcat{Grph}       % graphs / morphisms of graphs
\newcat{Quiv}       % quivers / morphisms of quivers
\newrcat[c]{Cat}    % categories / functors
\newcat{AbCat}      % Ab categories / additive functors
\newcat{CAT}        % large categories / functors
\newcat{Gpd}        % groupoids / homomorphisms
\newcat{Moncat}     % monoidal categories / monoidal functors

\newcat{Map}        % not actually a category
\newcat{Mor}        % ...?
\newcat{Funct}      % functors / natural transformations
\newcat{End}        % endofunctors / natural transformations
\newcat{Nat}        % natural transformations
\newcat{Cone}       % cones

% Cats: Tops $
\newcat{Top}        % topological spaces / continuous maps
\newcat{Toph}       % topological spaces / maps modulo homotopy
\newcat{Htpy}       % " / "
\newpcat[cp]{Open}  % open subsets / inclusions

% Cats: Misc %
\newvcat[c]{Matr}   % natural numbers / matrices
\newcommand{\ecat}{\cancel{\cat{O}}} % empty category
\newcommand{\cDel}{\hstretch{0.8}{\varDelta}} % simplex category



%%% Delimiters %%%

\newcommand{\LeftRight}[5]{{
    \scalerel[2ex]{#3}{\vphantom{\left#1#4\right.}}
    #4
    \scalerel[2ex]{#5}{\vphantom{\left#2#4\right.}}
}}

\DeclareDocumentCommand{\newdelim}{ O{} O{} m m m }{%
    \expandafter\newcommand\csname #3\endcsname[1]{%
        {\left#4#1##1#2\right#5}
    }
}
% \newDelim[linner][rinner][lmodel][rmodel]{name}{ldelim}{rdelim}
\DeclareDocumentCommand{\newDelim}{ O{} O{} O{(} O{)} m m m }{%
    \expandafter\newcommand\csname #5\endcsname[1]{%
        \LeftRight{#3}{#4}{#6}{#1##1#2}{#7}
    }
}

\newcommand{\spacechoice}[4]{
    \mathchoice{\hspace{#1}}{\hspace{#2}}{\hspace{#3}}{\hspace{#4}}}

% ()
\providecommand{\lparens}{(}
\providecommand{\rparens}{)}
\providecommand{\llparens}
    {\mathchoice{\bigg(}{\big(}{(}{(}
        \spacechoice{-2.5pt}{-2.1pt}{-1.7pt}{-1.7pt}
            \mathchoice{\hstretch{1.3}{\bigg|}}{\big|}{|}{|}\hspace{-0.7pt}}
\providecommand{\rrparens}
    {\mathchoice{\hstretch{1.3}{\bigg|}}{\big|}{|}{|}
        \spacechoice{-2.5pt}{-2.1pt}{-1.7pt}{-1.7pt}
            \mathchoice{\bigg)}{\big)}{)}{)}}

\newdelim{Par}{\lparens}{\rparens}
\newDelim{Paar}{\llparens}{\rrparens}

% []
\providecommand{\lbrack}{[}
\providecommand{\rbrack}{]}
\providecommand{\llbrack}
    {\mathchoice{\bigg[}{\big[}{[}{[}\spacechoice{-4pt}{-3.1pt}{-1.3pt}{-1.2pt}
        \mathchoice{\bigg[}{\big[}{[}{[}\hspace{-0.4pt}}
\providecommand{\rrbrack}
    {\hspace{-0.4pt}\mathchoice{\bigg]}{\big]}{]}{]}
        \spacechoice{-4pt}{-3.1pt}{-1.3pt}{-1.2pt}\mathchoice{\bigg]}{\big]}{]}{]}}

\newdelim%[\spacechoice{2.2pt}{1pt}{0.8pt}{0.5pt}]
    %[\spacechoice{2.2pt}{1pt}{0.8pt}{0.5pt}]
    {Squ}{\lbrack}{\rbrack}
\newDelim{Sqqu}{\llbrack}{\rrbrack}

\newcommand{\LieSeparator}{,}
\newcommand{\Lie}[2]{\Squ{#1 \LieSeparator #2}}

% [) (]
\newdelim[][\spacechoice{1pt}{1pt}{0.8pt}{0.5pt}]{PSqu}{\lparens}{\rbrack}
\newdelim[\spacechoice{1pt}{1pt}{0.8pt}{0.5pt}][]{SPar}{\lbrack}{\rparens}
\newDelim{PSqqu}{\llparens}{\rrbrack}
\newDelim{SPaar}{\llbrack}{\rrparens}

% {}
\providecommand{\lbrace}{\{}
\providecommand{\rbrace}{\}}
\providecommand{\llbrace}
    {\mathchoice{\{}{\{}{\{}{\{}\spacechoice{-3.0pt}{-3.2pt}{-2.5pt}{-2.5pt}
        \mathchoice{\hstretch{1.5}{|}}{\hstretch{1.5}{|}}
            {\hstretch{1.5}{|}}{\hstretch{1.5}{|}}\hspace{-0.7pt}}
\providecommand{\rrbrace}
    {\hspace{-0.7pt}\mathchoice{\hstretch{1.5}{|}}{\hstretch{1.5}{|}}
            {\hstretch{1.5}{|}}{\hstretch{1.5}{|}}\spacechoice{-3.2pt}{-3.2pt}{-2.5pt}
                {-2.5pt}\mathchoice{\}}{\}}{\}}{\}}}

\newdelim[\spacechoice{1pt}{0pt}{0pt}{-0.5pt}]
    [\spacechoice{1pt}{0pt}{0pt}{-0.5pt}]{Cur}{\lbrace}{\rbrace}
\newDelim{Cuur}{\llbrace}{\rrbrace}
    
% ||
\newdelim%[\spacechoice{2.2pt}{1pt}{0.8pt}{-0.5pt}]
    %[\spacechoice{2.2pt}{1pt}{0.8pt}{-0.5pt}]
    {Abs}{|}{|}
\newdelim{Abbs}{\Vert}{\Vert}
\newcommand{\Nor}[1]{\Abbs{#1}}

% Ceiling and Floor
\newdelim[\spacechoice{2.2pt}{0pt}{0pt}{-1pt}][\spacechoice{2.2pt}{0pt}{0pt}{-1pt}]
    {Ceil}{\lceil}{\rceil}
\newdelim[\spacechoice{2.2pt}{0pt}{0pt}{-1pt}][\spacechoice{2.2pt}{0pt}{0pt}{-1pt}]
    {Flo}{\lfloor}{\rfloor}

% <>
% TODO: fix
%\newDelim{Ang}
%    {\mathchoice{\bigg\langle}{\langle}{\langle}{\langle}}
%    {\mathchoice{\bigg\rangle}{\rangle}{\rangle}{\rangle}}
\newdelim{Ang}{\langle}{\rangle}
\newDelim{Anng}
    {\mathchoice{\bigg\langle}{\langle}{\langle}{\langle}
        \spacechoice{-3.95pt}{-2.3pt}{-1.8pt}{-1.8pt}
            \mathchoice{\hstretch{1.5}{\bigg|}}{|}{|}{|}}
    {\mathchoice{\hstretch{1.5}{\bigg|}}{|}{|}{|}
        \spacechoice{-3.95pt}{-2.3pt}{-1.8pt}{-1.8pt}
            \mathchoice{\bigg\rangle}{\rangle}{\rangle}{\rangle}}

% f|
\newdelim{restr}{.}{|}

% f/g
\newcommand{\Quot}[2]{\left.#1\middle/#2\right.}

% <|
\newdelim{Bra}{\langle}{|}

\newDelim[][\spacechoice{1.6pt}{0.8pt}{0.8pt}{-0.5pt}]%
    {@Bra}%
    {\mathchoice{\bigg\langle}{\langle}{\langle}{\langle}}%
    {\mathchoice{\bigg|}{|}{|}{|}}

% |>
\newdelim{Ket}{|}{\rangle}
\newcommand{\Keet}[2]{\Ket{#1\,;#2}}

\newDelim[\spacechoice{1.6pt}{0.8pt}{0.8pt}{-0.5pt}][]%
    {@Ket}%
    {\mathchoice{\bigg|}{|}{|}{|}}%
    {\mathchoice{\bigg\rangle}{\rangle}{\rangle}{\rangle}}

% Comprehension {|}
\newcommand{\mkset}[2]{\left.\Cur{#1\spacechoice{2.2pt}{1pt}{0.8pt}{-0.5pt}\middle|\spacechoice{2.2pt}{1pt}{0.8pt}{-0.5pt}#2}\right.}

% Bra-Ket <|> <||>
\newcommand{\BraKet}[2]{\left.\Ang{#1\spacechoice{2.2pt}{1pt}{0.8pt}{-0.5pt}\middle|\spacechoice{2.2pt}{1pt}{0.8pt}{-0.5pt}#2}\right.}

\newcommand{\BrraKeet}[3]{\left.\Ang{#1\spacechoice{2.2pt}{1pt}{0.8pt}{-0.5pt}\middle|\spacechoice{2.2pt}{1pt}{0.8pt}{-0.5pt}#2\spacechoice{2.2pt}{1pt}{0.8pt}{-0.5pt}\middle|\spacechoice{2.2pt}{1pt}{0.8pt}{-0.5pt}#3}\right.}

%% Derivatives of the above %%
\newcommand{\angprod}{\Ang{\cdot\,,\cdot}}
\newcommand{\lieprod}{\Squ{\cdot\,,\cdot}}
\newcommand{\absprod}{\Abs{\cdot}}
\newcommand{\norprod}{\Nor{\cdot}}

%%% Operators %%%

\newcommand{\dfrc}[2]{\frac{\displaystyle{#1}}{\displaystyle{#2}}}

%% bigops %%
\newcommand{\newbigop}[2]{%
    \expandafter\DeclareRobustCommand\csname#1\endcsname{%
        
        \mathop{\vphantom{\sum}\expandafter\mathpalette\csname#1@bigop\endcsname\relax}\slimits@
    }

    \expandafter\newcommand\csname#1@bigop\endcsname[2]{%
        \vcenter{%
            \sbox\z@{$##1\sum$}%
            \hbox{\resizebox{.9\dimexpr\ht\z@+\dp\z@}{!}{$\ThisStyle{##1}\m@th#2$}}%
        }%
    }
}

\let\f@tstar\bigstar
\def\fatstar{\mathbin{\scalerel*{\f@tstar}{\ThisStyle{}\times}}}
%\let\@star\bigstar
%\def\star{\scriptstyle{\@star}}
\newbigop{bigstar}{\star}
\newbigop{bigast}{\ast}
\newbigop{bigfatstar}{\fatstar}

\newcommand{\smash@display}{%
\begin{tikzpicture}[rotate=45,x=0.5ex,y=0.5ex]
\draw[line width=.095ex, line cap=round] (0,2) -- (3,2) (0,1) -- (3,1) (1,3) -- (1,0) (2,3) -- (2,0);
\end{tikzpicture}
}
\newcommand{\smash@other}{%
\begin{tikzpicture}[rotate=45,x=0.5ex,y=0.5ex]
\draw[line width=.12ex, line cap=round] (0,2) -- (3,2) (0,1) -- (3,1) (1,3) -- (1,0) (2,3) -- (2,0);
\end{tikzpicture}
}

\newcommand{\smashtimes}{\mathbin{\smash@other}}

\newbigop{bigsmash}{\mathchoice{\smash@display}{\smash@other}{\smash@other}{\smash@other}}

\newcommand{\hash}{\mathbin{\#}}
\newbigop{bighash}{\#}

\newcommand{\at}{\mathbin{\text{@}}}
\newbigop{bigat}{\text{@}}

\newbigop{bigdiv}{\div}

%\let\prod@old\prod
%\newbigop{prod}{\mathchoice{\textstyle{\prod@old}}{\prod@old}{\prod@old}{\prod@old}}

%\let\coprod@old\coprod
%\newbigop{coprod}{\mathchoice{\textstyle{\coprod@old}}{\coprod@old}{\coprod@old}
%{\coprod@old}}

\newcommand{\plus@display}{%
\begin{tikzpicture}%[rotate=45,x=0.5ex,y=0.5ex]
\draw[line width=.4ex, line cap=round] (0,0) -- (1,0) (0.5,-0.5) -- (0.5,0.5);
\end{tikzpicture}
}
\newcommand{\plus@other}{%
\begin{tikzpicture}%[rotate=45,x=0.5ex,y=0.5ex]
\draw[line width=0.6ex, line cap=round] (0,0) -- (1,0) (0.5,-0.5) -- (0.5,0.5);
\end{tikzpicture}
}

\newcommand{\times@display}{%
\begin{tikzpicture}[rotate=45,x=0.5ex,y=0.5ex]
\draw[line width=.065ex, line cap=round] (0,1.5) -- (3,1.5) (1.5,3) -- (1.5,0);
\end{tikzpicture}
}
\newcommand{\times@other}{%
\begin{tikzpicture}[rotate=45,x=0.5ex,y=0.5ex]
\draw[line width=.12ex, line cap=round] (0,1.5) -- (3,1.5) (1.5,3) -- (1.5,0);
\end{tikzpicture}
}

\newbigop{bigplus}{\mathchoice{\plus@display}{\plus@other}{\plus@other}{\plus@other}}
%\newbigop{bigtimes}{\mathchoice{\times@display}{\times@other}{\times@other}{\times@other}}

\DeclareMathOperator{\arccsc}{arccsc}
\DeclareMathOperator{\arcsec}{arcsec}
\DeclareMathOperator{\arccot}{arccot}

\def\optimes{\mathop{\otimes}}

%% Algebra %%
\DeclareMathOperator{\img}{im}
\DeclareMathOperator{\coker}{coker}
\newcommand{\image}{\img} %% deprecated
\DeclareMathOperator{\Span}{span}
\DeclareMathOperator{\sign}{sign}
\newcommand{\transp}{^{\mathrm{T}}}
\newcommand{\cotran}{^\dagger}
\newcommand{\opp}{^{\mathrm{op}}}
\newcommand{\dual}{^*}
\newcommand{\comp}{^{\mathrm{c}}}
\DeclareMathOperator{\tr}{tr}
\DeclareMathOperator{\Res}{\vphantom{d}Res}
\DeclareMathOperator{\Ind}{Ind}
\DeclareMathOperator{\Ann}{Ann}
\DeclareMathOperator{\Frac}{Frac}
\DeclareMathOperator{\Char}{char}

\newcommand{\powset}[1]{\CP\left(#1\right)} 

\renewcommand{\mod}{\mathrel{\rmn{mod}}}

% I'll be honest, I hate \Re and \Im
\def\Re{\lie{R}}%{\mathscr{R}}
\def\Im{\lie{I}}%{\mathscr{I}}

%% Categories %%
\DeclareMathOperator{\Hom}{\cat{hom}} % hom-set
\DeclareMathOperator{\Endo}{End}      % endomorphism
\DeclareMathOperator{\Aut}{Aut}       % automorphism
\DeclareMathOperator{\Obj}{\cat{obj}} % category objects
\DeclareMathOperator{\Mor}{\cat{mor}} % category morphisms
\DeclareMathOperator{\Dom}{\cat{dom}} % domain
\DeclareMathOperator{\Cod}{\cat{cod}} % codomain
\newcommand*\prd{\times}              % product
\newcommand{\coprd}{\amalg}           % coproduct 
\newcommand{\Colim}{\varinjlim}       % colimit
\newcommand{\Lim}{\varprojlim}        % lim
\newcommand{\Id}{\cat{id}}            % category identity map

\DeclareMathOperator{\Rad}{\cat{rad}} 
  
%% Topology %%
\DeclareMathOperator{\Int}{Int} % interior
\DeclareMathOperator{\Ext}{Ext} % exteriror
\DeclareMathOperator{\Bd}{Bd}   % boundary
\newcommand{\qsim}{{/{\sim}}}
\newcommand{\op}[1]{#1^\circ}
 
%% Analysis %% 
 
% this defines what dx actually looks like %
\newcommand{\diff}{\mathrm{\mathstrut d}}
 
% low-level tex for dx, via ISO-31 %
\makeatletter
\providecommand*{\rawdiff}{\@ifnextchar^{\DIfF}{\DIfF^{}}}
\def\DIfF^#1{\mathop{\diff}\nolimits^{#1}\gobblespace}
\def\gobblespace{\futurelet\diffarg\opspace}
\def\opspace{\let\DiffSpace\!\ifx\diffarg(\let\DiffSpace\relax\else\ifx\diffarg[\let\DiffSpace\relax\else\ifx\diffarg\{\let\DiffSpace\relax\fi\fi\fi\DiffSpace}
% %
 
\newcommand{\D}{\rawdiff}
\newcommand{\DD}{\mathrm{D}}
\newcommand{\del}{\partial}
%\newcommand{\nab}{\vnabla}
% \leib[2]{d}{f}{x} -> (d^2 f)/dx^2
\providecommand*{\leib}[4][]{\frac{#2^{#1}#3}{#2 #4^{#1}}}

\newcommand{\od}[3][]{\leib[#1]{\D}{#2}{#3}}
\newcommand{\Dd}[3][]{\leib[#1]{\DD}{#2}{#3}}
\newcommand{\pd}[3][]{\leib[#1]{\del}{#2}{#3}}

\newcommand{\cnt}{\CC} % function ranks, e.g. \cnt^0 -> continuous functions
\newcommand{\rie}{\LR} % riemann integrable funcs
\newcommand{\lbe}{\CL} % lebesgue integrable funcs

\let\@iint\varoiint
\let\varoiint\oiint
\let\oiint\@iint
 
%% Vect Calc %%
\DeclareMathOperator{\grad}{grad}
\DeclareMathOperator{\dive}{div}
\DeclareMathOperator{\curl}{curl}

\newcommand{\Grad}{\vnabla}
\newcommand{\Dive}{\vnabla\cdot}
\newcommand{\Curl}{\vnabla\times}
\newcommand{\laplace}{\vnabla^2}

%% Wordz %%
\newcommand{\AND}{\,\mathrm{and}\,}
\newcommand{\OR}{\,\mathrm{or}\,}
\newcommand{\XOR}{\,\mathrm{xor}\,}
\newcommand{\IF}{\,\mathrm{if}\,}
\newcommand{\IFF}{\,\mathrm{iff}\,}
\newcommand{\ST}{\,\mathrm{such\,that}\,}
\newcommand{\OTHER}{\,\mathrm{otherwise}\,}
\newcommand{\ELSE}{\,\mathrm{else}\,}
\newcommand{\IN}{\,\mathrm{in}\,}
\newcommand{\FOR}{\,\mathrm{for}\,} 

%% Misc %%
\renewcommand{\to}{\rightarrow}
\newcommand{\To}{\Rightarrow}
\newcommand{\toto}{\rightrightarrows}
\newcommand{\from}{\leftarrow}
\newcommand{\fromfrom}{\leftleftarrows}
\newcommand{\fromto}{\leftrightarrow}
\newcommand{\up}{\uparrow}
\newcommand{\upup}{\upuparrows}
\newcommand{\down}{\downarrow}
\newcommand{\downdown}{\downdownarrows}
\newcommand{\toself}{\circlearrowright}
\newcommand{\inj}{\hookrightarrow}
\newcommand{\srj}{\rightarrow\!\!\!\!\!\!\!\rightarrow}
\newcommand{\nato}{\rmap{\hstretch{2}{\vstretch{2}{.}}}}
\newcommand{\adj}{\rightharpoonup}
\newcommand{\acts}{\curvearrowright}
\newcommand{\acted}{\curvearrowleft}

\newcommand{\FirstWay}{\noindent($\Rightarrow$). }
\newcommand{\OtherWay}{\noindent($\Leftarrow$). }

\newcommand{\nto}{\not\to}
\DeclareMathOperator{\ide}{id}

\newcommand{\rmap}[1]{\xrightarrow{#1}}
\newcommand{\lmap}[1]{\xleftarrow{#1}}

\DeclareMathOperator{\lcd}{lcd} 
\DeclareMathOperator{\sech}{sech}
\DeclareMathOperator{\csch}{csch}
\DeclareMathOperator{\erf}{erf}
%\renewcommand{\mod}[1]{\left(\mathrm{mod}\,#1\right)}

\newcommand{\nin}{\notin}
\newcommand{\subS}{\sbs}
\newcommand{\supS}{\sps}
\newcommand{\sbs}{\subset}
\newcommand{\sps}{\supset}
\newcommand{\sans}[1][]{\setminus\@exists{#1}{\Cur{#1}}{}}
\newcommand{\sansz}{\sans[0]}

\let\@cong\cong
\newcommand{\ind}{\fld{1}}
\newcommand{\isom}{\simeq}
\newcommand{\homeo}{\@cong}
\renewcommand{\cong}{\equiv}
\newcommand{\isdef}{:=}

\newcommand{\ov}{\overline}
\newcommand{\un}{\underline}
\newcommand{\tl}{\tilde}

\newcommand{\jacobi}[2]{\Par{\frac{#1}{#2}}}

%% Physics %%

\newcommand{\KE}{K\hspace{-0.6ex}E}
\newcommand{\rA}{\text{\normalfont\AA}}

\def\labar{\protect\@lambdabar}
\def\@lambdabar{%
\relax
\bgroup
\def\@tempa{\hbox{\raise.8\ht0
\hbox to0pt{\kern.15\wd0\vrule width.65\wd0
height.25pt depth.1pt\hss}\box0}}% 
\mathchoice{\setbox0\hbox{$\displaystyle\lambda$}\@tempa}%
{\setbox0\hbox{$\textstyle\lambda$}\@tempa}%
{\setbox0\hbox{$\scriptstyle\lambda$}\@tempa}%
{\setbox0\hbox{$\scriptscriptstyle\lambda$}\@tempa}%
\egroup
}

\def\ham{{\hat{\CH}}}

%% SI Inits %

\sisetup{
    inter-unit-product = \ensuremath{{}\cdot{}}
}

%%% Pset templating %%%
%% TODO: make this a class

\newcommand{\psetSubject}[1]{\def\pset@subject{#1}}
\def\pset@subject{undefined}

\newcommand{\psetAuthor}[1]{\def\pset@author{#1}}
\def\pset@author{Miguel Young}

\newcommand{\psetNum}[1]{\def\pset@num{#1}}
\def\pset@num{undefined}

\newcommand{\psetCollabs}[1]{\def\pset@collabs{#1}}
\def\pset@collabs{}

\newcommand{\psetSources}[1]{\def\pset@sources{#1}}
\def\pset@sources{}

\newcommand{\psetTitle}[1]{%
    \newpage
    \begin{center}
        \makeatletter
        {\huge \pset@subject{} Pset \pset@num{} #1 }

        {\large \pset@author}

        \ifthenelse{\equal{\pset@collabs}{}}{}{Collaborators: \pset@collabs}
        
        \ifthenelse{\equal{\pset@sources}{}}{}{Sources: \pset@sources}
        \makeatother
    \end{center}
}

\newcommand{\makePsetTitle}{\psetTitle{}}
\newcommand{\mkPsetTitle}{\makePsetTitle}

\newcounter{pset@ProblemCounter}
\setcounter{pset@ProblemCounter}{0}
\newenvironment{psetProblem}{%
    \makeatletter
    \stepcounter{pset@ProblemCounter}
    \psetTitle{Problem \arabic{pset@ProblemCounter}}
    \makeatother
}{}

%%% Matrices %%%
%% Square %%

\newcommand{\btwo}[4]{%
    \begin{bmatrix}
        #1 & #2 \\ #3 & #4
    \end{bmatrix}
}


\newcommand{\bthree}[9]{%
    \begin{bmatrix}
        #1 & #2 & #3 \\ 
        #4 & #5 & #6 \\
        #7 & #8 & #9 
    \end{bmatrix}
}

\newcommand{\Vbtwo}[2]{%
    \begin{bmatrix}
        #1 \\ #2
    \end{bmatrix}
}

\newcommand{\Hbtwo}[2]{%
    \begin{bmatrix}
        #1 & #2
    \end{bmatrix}
}

\newcommand{\Vbthree}[3]{%
    \begin{bmatrix}
        #1 \\ #2 \\ #3
    \end{bmatrix}
}

\newcommand{\Hbthree}[3]{%
    \begin{bmatrix}
        #1 & #2 & #3
    \end{bmatrix}
}

%% Round %%

\newcommand{\ptwo}[4]{%
    \begin{pmatrix}
        #1 & #2 \\ 
        #3 & #4
    \end{pmatrix}
}

\newcommand{\pthree}[9]{%
    \begin{pmatrix}
        #1 & #2 & #3 \\ 
        #4 & #5 & #6 \\
        #7 & #8 & #9 
    \end{pmatrix}
}

\newcommand{\Vptwo}[2]{%
    \begin{pmatrix}
        #1 \\ #2
    \end{pmatrix}
}

\newcommand{\Hptwo}[2]{%
    \begin{pmatrix}
        #1 & #2
    \end{pmatrix}
}
\newcommand{\Vpthree}[3]{%
    \begin{pmatrix}
        #1 \\ #2 \\ #3
    \end{pmatrix}
}

\newcommand{\Hpthree}[3]{%
    \begin{pmatrix}
        #1 & #2 & #3
    \end{pmatrix}
}

%% Vert %%

\newcommand{\Vtwo}[4]{%
    \begin{vmatrix}
        #1 & #2 \\ 
        #3 & #4
    \end{vmatrix}
}

\newcommand{\Vthree}[9]{%
    \begin{vmatrix}
        #1 & #2 & #3 \\ 
        #4 & #5 & #6 \\
        #7 & #8 & #9 
    \end{vmatrix}
}

\newcommand{\VVtwo}[2]{%
    \begin{vmatrix}
        #1 \\ #2
    \end{vmatrix}
}

\newcommand{\HVtwo}[2]{%
    \begin{vmatrix}
        #1 & #2
    \end{vmatrix}
}
\newcommand{\VVthree}[3]{%
    \begin{vmatrix}
        #1 \\ #2 \\ #3
    \end{vmatrix}
}

\newcommand{\HVthree}[3]{%
    \begin{vmatrix}
        #1 & #2 & #3
    \end{vmatrix}
}

%%% OPTIONS %%%
\newcommand{\checkfor}[2]{%
    \ifcsname#1\endcsname%
        #2%
    \fi%
}
\DeclareOption{shortST}{%
    \def\ST{\,\mathrm{s.t.}\,}
}
\DeclareOption{vec}{
    \usevec
}
\DeclareOption{veca}{
    \useveca
}
\ProcessOptions\relax
%%% OPTIONS %%%

\endinput
%%
%% End of file `xor.sty'.
