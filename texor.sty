% (c) 2015 Miguel Young
%
%% This program can be redistributed and/or modified under the terms
%% of the LaTeX Project Public License Distributed from CTAN archives
%% in directory macros/latex/base/lppl.txt.
% 
\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{texor}
  [2015/01/01 v1.0 teXor LaTeX Suite]

\let\h@rpoon\rightharpoonup
\def\texor@nop#1{#1}

\providecommand{\texor@hook@prefont}{}
\providecommand{\texor@hook@postfont}{}
\providecommand{\texor@hook@postfontalias}{}
\providecommand{\texor@hook@postoperators}{}

%%% OPTIONS %%%
\DeclareOption{vakil}{
    \let\texor@vakiltemp@hook@prefont=\texor@hook@prefont
    \renewcommand{\texor@hook@prefont}{
        \texor@vakiltemp@hook@prefont
        \setmainfont{Palatino}
        \undef\hat
        \undef\vec
        \RequirePackage[mathbf]{euler}
    }
    \let\texor@vakiltemp@hook@postfontalias=\texor@hook@postfontalias
    \renewcommand{\texor@hook@postfontalias}{
        \texor@vakiltemp@hook@postfontalias
        \DeclareMathAlphabet{\texor@vakil@text@roman}{OT1}{ppl}{m}{n}
        \DeclareMathAlphabet{\texor@vakil@text@bold}{OT1}{ppl}{b}{n}
        \texor@fonts@alias{text-roman}{\texor@vakil@text@roman}
        \texor@fonts@alias{text-bold}{\texor@vakil@text@bold}
        \texor@fonts@alias{math-roman}{\texor@nop}
    }
    \let\texor@vakiltemp@hook@postoperators=\texor@hook@postoperators
    \renewcommand{\texor@hook@postoperators}{
        \texor@vakiltemp@hook@postoperators
        \renewcommand{\euler}{\ve}
    }
}

\DeclareOption{frak-imaginary}{
    \let\texor@frakimaginary@hook@postoperators=\texor@hook@postoperators
    \renewcommand{\texor@hook@postoperators}{
        \texor@frakimaginary@hook@postoperators
        \renewcommand{\qI}{\Li}
        \renewcommand{\qJ}{\Lj}
        \renewcommand{\qK}{\Lk}
    }
}

\ProcessOptions\relax
%%% OPTIONS %%%

%% Style Note %%
% All internal commands should
% be of the form \texor@section@name
% where `Section` is the part of the 
% package it's declared in, and `name`
% is the actual command name.
%% %% %%%% %% %%

%%% IMPORTS %%%
\RequirePackage{amsthm}
\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{amsfonts}

\RequirePackage{pgfkeys}
\RequirePackage{xparse}
\RequirePackage{xstring}
\RequirePackage{ifthen}
\RequirePackage{enumitem}

\RequirePackage{graphicx}
\RequirePackage{scalerel}
\RequirePackage{xcolor}
\RequirePackage{tikz}
\RequirePackage{tikz-cd}

\RequirePackage{verbatim}

\RequirePackage{bm}
\RequirePackage{mathalfa}
\RequirePackage{accsupp}
\RequirePackage{esint}
\RequirePackage{mathtools}
\RequirePackage{mathrsfs}
\RequirePackage{accents}
\RequirePackage[bbgreekl]{mathbbol}

\RequirePackage{siunitx}
\RequirePackage{qtree}
%%% IMPORTS %%%

%%% FONT STUFF %%%
\def\amsbb{\use@mathgroup \M@U \symAMSb} % magic

\RequirePackage[no-math]{fontspec}

\providecommand{\texor@hook@prefont}{}
\texor@hook@prefont

%\RequirePackage{xunicode}
%\newfontfamily\xitsbb{XITS Math}

%% TIPA nonsense
% so, tipa redefines a bunch of macros, because they don't
% understand groups. thanks. luckily, tipa provides a reset command!

\undef\sups
\RequirePackage{tipa}

% save the magic commands
\let\texor@tipa@colon\:
\let\texor@tipa@semi\;
\let\texor@tipa@bang\!
\let\texor@tipa@star\*
\let\texor@tipa@pipe\|
\let\texor@tipa@syl\s

% reset them to LaTeX settings
\tipasafemode

% now we re-add them!

\newcommand{\texor@tipa@pre}{%
    \let\:\texor@tipa@colon%
    \let\;\texor@tipa@semi%
    \let\!\texor@tipa@bang%
    \let\*\texor@tipa@star%
    \let\|\texor@tipa@pipe%
    \texor@tipa@mathwrap{\~}{\tilde}%
    \texor@tipa@mathwrap{\^}{\hat}%
    \texor@tipa@mathwrap{\v}{\check}%
    \texor@tipa@mathwrap{\`}{\grave}%
    \texor@tipa@mathwrap{\'}{\acute}%
    \texor@tipa@mathwrap{\s}{\underset{\text{\textipa{"}}}}%
}

\newcommand{\texor@tipa@stripdot}[1]{\ifx#1i\i\else\ifx#1j\j\else#1\fi\fi}

\newcommand{\texor@tipa@mathwrap}[2]{%
    \renewcommand{#1}[1]{$#2{\text{\textipa{\texor@tipa@stripdot{##1}}}}$}%
}

\newcommand{\texor@tipa@internal}[2][r]{%
    \begingroup
    \fontfamily{cm#1}%
    \texor@tipa@pre%
    \tipaencoding{#2}%
    \endgroup
}

% redefine the TIPA commands
\AtBeginDocument{
    \renewcommand\textipa[2][r]{{\texor@tipa@internal[#1]{#2}}}
}
\renewenvironment{IPA}[1][r]{%
    \fontfamily{cm#1}%
    \texor@tipa@pre%
    \tipaencoding%
}{}
%% End TIPA

% everything beyond this point *must*
% come after tipa, because tipa does
% font voodoo

\DeclareSymbolFontAlphabet{\mathbba}{AMSb}
\DeclareSymbolFontAlphabet{\mathbbl}{bbold}

\let\amscal\mathcal
\DeclareMathAlphabet{\othercal}{OT1}{pzc}{m}{it}

\let\amsbf\mathbf
\renewcommand{\mathbf}[1]{\bm{\mathrm{#1}}}

\providecommand{\texor@hook@postfont}{}
\texor@hook@postfont
%%% END FONT STUFF %%%

%% this is for fun. really.
\newcommand{\TeXoR}
    {\TeX \hspace{-0.875ex}{\raisebox{0.31ex}{o}}\hspace{-0.55ex}R}

%% the \texor@exists{test}{then}{else} macro
% takes a string, and if it is nontrivial, outputs 
% `then`. otherwise, it outputs `else`.
% it works by sticking the argument between two copies
% of a dummy command; if the argument is empty, the
% two dummy commands come together, which makes
% \ifx take the first branch (since the two tokens after
% it are equal)
\def\texor@exists@dummy{}
\newcommand{\texor@exists}[3]{%
    \ifx\texor@exists@dummy#1\texor@exists@dummy%
        #3%
    \else%
        #2%
    \fi%
}
\newcommand{\texor@exists@phantom}[2][0]{\texor@exists{#2}{#2}{\hphantom{#1}}}
\newcommand*{\texor@exists@counter}[3]{%
  \ifcsname c@#1\endcsname
    #2
  \else
    #3
  \fi
}

\newcommand{\texor@ifnext}[3][*]{\new@ifnextchar#1{\def\reserved@a#1{#2}\reserved@a}{#3}}

%% a switch statement
\newcommand{\texor@switch@ifequals}[3]{\ifthenelse{\equal{#1}{#2}}{#3}{}}
\newcommand{\switch}[2]{%
\newcommand{\case}[2]{\texor@switch@ifequals{#1}{##1}{##2}}#2\undef\case}

%%% Preamble %%%
\newcommand{\texor@call}[1]{\csname#1\endcsname}

% I have no idea what this does
\def\changemargin#1#2{\list{}{\rightmargin#2\leftmargin#1}\item[]}
\let\endchangemargin=\endlist

% or this... I think it stands for overset?
\newcommand{\oset}[3][0ex]{%
  {\mathop{#3}\limits^{
    \vbox to#1{\kern-2\ex@
    \hbox{$#2$}\vss}}}}

%% this is for the SI package.
% little sigma is more important.
\let\esi\si
\let\si\relax

%%% Theorems %%%

\let\defaultqed\qedsymbol

\newcounter{globaltheoremcounter}
% generates theorem environments
\newcommand{\texor@thm@gen}[2]{
    \ifthenelse{\equal{#1}{thm}}{
        \newtheorem{S#1}{#2}[section] % section
        \texor@exists@counter{chapter}{
        \newtheorem{C#1}{#2}[chapter] % chapter
        }{}
    }{
        \newtheorem{S#1}[Sthm]{#2}    % section
        \texor@exists@counter{chapter}{
        \newtheorem{C#1}[Cthm]{#2}    % chapter
        }{}
    }
    \newtheorem{#1}{#2}           % numbered
    \newtheorem*{#1*}{#2}         % unnumbered
}

% the /contradiction/ environment!
\def\deqsymbol{$\smashtimes$}
\newenvironment{proof*}[1][Proof]
    {\begin{proof}[#1]\def\qedsymbol{\deqsymbol}}
    {\end{proof}\def\deqsymbol{$\smashtimes$}}

% generates proof environments
\newcommand{\texor@thm@genproof}[3][]{%
    \newenvironment{#2}
        {\begin{proof}[#3] \texor@exists{#1}{\def\qedsymbol{#1}}{}}
        {\end{proof}}
}

% generates contradiction environments
\newcommand{\texor@thm@gencontr}[3][]{%
    \newenvironment{#2}
        {\begin{proof*}[#3] \texor@exists{#1}{\def\deqsymbol{#1}}{}}
        {\end{proof*}}
}

%\theoremstyle{normal}

\texor@thm@gen{thm}{Theorem}
\texor@thm@gen{lem}{Lemma}
\texor@thm@gen{prop}{Proposition}
\texor@thm@gen{cor}{Corollary}

\theoremstyle{definition}

\texor@thm@gen{defn}{Definition}
\texor@thm@gen{axi}{Axiom}
\texor@thm@gen{conj}{Conjecture}
\texor@thm@gen{example}{Example}
\texor@thm@gen{exercise}{Exercise}
\texor@thm@gen{prob}{Problem}
\texor@thm@gen{fact}{Fact}

\theoremstyle{remark}

\texor@thm@gen{rem}{Remark}
\texor@thm@gen{note}{Note}
\texor@thm@gen{notation}{Notation}
  
\texor@thm@genproof{solution}{Solution}

%% the casework environment is secretly a list!
\newlist{casework}{enumerate}{4}
\setlist[casework]{
    label*=\arabic*.,
    leftmargin=!,
    wide,
    labelwidth=!, labelindent=0pt
}
\setlist[casework,1]{
    label={\emph{Case} \arabic*.}
}

\newlist{probenumlist}{enumerate}{1}
\setlist[probenumlist]{
    label=(\alph*),
    leftmargin=!,
    wide,
    labelwidth=!, labelindent=0pt
}

\newcommand{\resetQED}{
    \renewcommand{\qedsymbol}{$\qed@symbol$}
    \renewcommand{\deqsymbol}{$\smashtimes$}
}

\newenvironment{probenum}[2][]{%
    \begin{prob}[#1] \texor@exists{#2}{#2}{\hfill}%
        \begin{probenumlist}%
            
}{%
        \end{probenumlist}%
    \end{prob}%
}

\newenvironment{probenum*}[2][]{%
    \begin{prob*}[#1] \texor@exists{#2}{#2}{\hfill}%
        \begin{probenumlist}%
            
}{%
        \end{probenumlist}%
    \end{prob*}%
}

\newcommand{\skipprob}[1][1]{\addtocounter{prob}{#1}}

%%% Variables %%%

%% General font magic %%

% Magic for mathbb/mathcal %
\newcommand{\texor@fonts@ifcapital}[3]{{\ifthenelse{
    \equal{#1}{A} \OR \equal{#1}{B} \OR \equal{#1}{C} \OR \equal{#1}{D} \OR
    \equal{#1}{E} \OR \equal{#1}{F} \OR \equal{#1}{G} \OR \equal{#1}{H} \OR
    \equal{#1}{I} \OR \equal{#1}{J} \OR \equal{#1}{K} \OR \equal{#1}{L} \OR
    \equal{#1}{M} \OR \equal{#1}{N} \OR \equal{#1}{O} \OR \equal{#1}{P} \OR
    \equal{#1}{Q} \OR \equal{#1}{R} \OR \equal{#1}{S} \OR \equal{#1}{T} \OR
    \equal{#1}{U} \OR \equal{#1}{V} \OR \equal{#1}{W} \OR \equal{#1}{X} \OR
    \equal{#1}{Y} \OR \equal{#1}{Z}
}{\texor@call{#2}{#1}}{\texor@call{#3}{#1}}}}

\def\texor@fonts@bb@outer#1{\texor@fonts@bb@loop#1\relax}
\def\texor@fonts@bb@loop#1{\ifx\relax#1\else\texor@fonts@ifcapital{#1}{mathbba}{mathbbl}\expandafter\texor@fonts@bb@loop\fi}
\def\texor@fonts@bb#1{\expandafter\texor@fonts@bb@outer\expandafter{#1}}

\def\texor@fonts@cal@outer#1{\texor@fonts@cal@loop#1\relax}
\def\texor@fonts@cal@loop#1{\ifx\relax#1\else\texor@fonts@ifcapital{#1}{amscal}{othercal}\expandafter\texor@fonts@cal@loop\fi}
\def\mathcal#1{\expandafter\texor@fonts@cal@outer\expandafter{#1}}
% End Magic %

%% Variable formats %%

\newcommand{\texor@fonts@alias}[2]{
    \expandafter\providecommand\csname texor@font@#1\endcsname{#2}
    \expandafter\renewcommand\csname texor@font@#1\endcsname{#2}
}
\newcommand{\texor@fonts@call}[2]{
    \csname texor@font@#1\endcsname{#2}
}
\DeclareDocumentCommand{\texor@fonts@choice}{ O{text-roman} m }
    {\texor@fonts@call{#1}{#2}}

\texor@fonts@alias{text-roman}{\mathrm}
\texor@fonts@alias{text-italic}{\texor@nop}
\texor@fonts@alias{text-bold}{\mathbf}
\texor@fonts@alias{text-sans}{\mathsf}
\texor@fonts@alias{text-type}{\mathtt}

\texor@fonts@alias{math-roman}{\mathrm}
\texor@fonts@alias{math-ital}{\texor@nop}
\texor@fonts@alias{math-bold}{\mathbf}
\texor@fonts@alias{math-sans}{\mathsf}
\texor@fonts@alias{math-type}{\mathtt}

\texor@fonts@alias{math-cal}{\mathcal}
\texor@fonts@alias{math-black}{\texor@fonts@bb}
\texor@fonts@alias{math-frak}{\mathfrak}
\texor@fonts@alias{math-scr}{\mathcal}

\newcommand{\vect}{\texor@fonts@choice[math-bold]}
\newcommand{\cat}{\texor@fonts@choice[math-cal]}
\newcommand{\namedCat}{\texor@fonts@choice[text-bold]}
\newcommand{\fld}{\texor@fonts@choice[math-black]}
\newcommand{\lie}{\texor@fonts@choice[math-frak]}
\newcommand{\rmn}{\texor@fonts@choice[text-roman]}


\newcommand{\ivect}{\bm}
\newcommand{\ihatt}[1]{\hat{\bm{#1}}}
\newcommand{\hatt}[1]{\mathbf{\hat{#1}}}
\newcommand{\veca}[1]{\vec{\mathbf{#1}}}

\providecommand{\texor@hook@postfontalias}{}
\texor@hook@postfontalias

\newcommand{\texor@fonts@letter@par}[1]{\texor@exists{#1}{\Par{#1}}{}}
% \texor@fonts@letter{letter}{prefix}{command}
% produces a single letter for an alphabet
\def\texor@fonts@letter@base#1#2#3{%
    \expandafter\providecommand\csname#2\endcsname[1][]
        {\csname#3\endcsname{#1}\texor@fonts@letter@par{##1}}
}

\def\texor@fonts@letter@force#1#2#3{%
    \expandafter\undef\csname#2\endcsname
    \expandafter\newcommand\csname#2\endcsname[1][]
        {\csname#3\endcsname{#1}\texor@fonts@letter@par{##1}}
}

\newcommand{\texor@fonts@letter}[3]{\texor@fonts@letter@base{#1}{#2#1}{#3}}

% \texor@fonts@alphabet{prefix}{command}
% produces an entire alphabet
\newcommand{\texor@fonts@alphabet@lower}[2]{
    \texor@fonts@letter{a}{#1}{#2} \texor@fonts@letter{n}{#1}{#2}
    \texor@fonts@letter{b}{#1}{#2} \texor@fonts@letter{o}{#1}{#2}
    \texor@fonts@letter{c}{#1}{#2} \texor@fonts@letter{p}{#1}{#2}
    \texor@fonts@letter{d}{#1}{#2} \texor@fonts@letter{q}{#1}{#2}
    \texor@fonts@letter{e}{#1}{#2} \texor@fonts@letter{r}{#1}{#2}
    \texor@fonts@letter{f}{#1}{#2} \texor@fonts@letter{s}{#1}{#2}
    \texor@fonts@letter{g}{#1}{#2} \texor@fonts@letter{t}{#1}{#2}
    \texor@fonts@letter{h}{#1}{#2} \texor@fonts@letter{u}{#1}{#2}
    \texor@fonts@letter{i}{#1}{#2} \texor@fonts@letter{v}{#1}{#2}
    \texor@fonts@letter{j}{#1}{#2} \texor@fonts@letter{w}{#1}{#2}
    \texor@fonts@letter{k}{#1}{#2} \texor@fonts@letter{x}{#1}{#2}
    \texor@fonts@letter{l}{#1}{#2} \texor@fonts@letter{y}{#1}{#2}
    \texor@fonts@letter{m}{#1}{#2} \texor@fonts@letter{z}{#1}{#2}
}

\newcommand{\texor@fonts@alphabet@upper}[2]{
    \texor@fonts@letter{A}{#1}{#2} \texor@fonts@letter{N}{#1}{#2}
    \texor@fonts@letter{B}{#1}{#2} \texor@fonts@letter{O}{#1}{#2}
    \texor@fonts@letter{C}{#1}{#2} \texor@fonts@letter{P}{#1}{#2}
    \texor@fonts@letter{D}{#1}{#2} \texor@fonts@letter{Q}{#1}{#2}
    \texor@fonts@letter{E}{#1}{#2} \texor@fonts@letter{R}{#1}{#2}
    \texor@fonts@letter{F}{#1}{#2} \texor@fonts@letter{S}{#1}{#2}
    \texor@fonts@letter{G}{#1}{#2} \texor@fonts@letter{T}{#1}{#2}
    \texor@fonts@letter{H}{#1}{#2} \texor@fonts@letter{U}{#1}{#2}
    \texor@fonts@letter{I}{#1}{#2} \texor@fonts@letter{V}{#1}{#2}
    \texor@fonts@letter{J}{#1}{#2} \texor@fonts@letter{W}{#1}{#2}
    \texor@fonts@letter{K}{#1}{#2} \texor@fonts@letter{X}{#1}{#2}
    \texor@fonts@letter{L}{#1}{#2} \texor@fonts@letter{Y}{#1}{#2}
    \texor@fonts@letter{M}{#1}{#2} \texor@fonts@letter{Z}{#1}{#2}
}

\newcommand{\texor@fonts@alphabet}[2]{
    \texor@fonts@alphabet@upper{#1}{#2}
    \texor@fonts@alphabet@lower{#1}{#2}
}

%% Shorthands %%
\texor@fonts@letter@base{\ell}{vl}{vect}
\texor@fonts@letter@base{\textnormal{\bfseries\i}}{vii}{bm}
\texor@fonts@letter@base{\textnormal{\bfseries\j}}{vjj}{bm}
\texor@fonts@letter@base{\ii}{hi}{hat}
\texor@fonts@letter@base{\jj}{hj}{hat}
\texor@fonts@letter@base{\vii}{Hi}{hat}
\texor@fonts@letter@base{\vjj}{Hj}{hat}
\texor@fonts@letter@base{i}{fii}{fld}
\texor@fonts@letter@base{l}{Cll}{cat}
\texor@fonts@letter@base{p}{Cpp}{cat}
\texor@fonts@letter@force{j}{Lj}{lie}
\texor@fonts@letter@force{J}{LJ}{lie}

\newcommand{\vzero}{\vect{0}}
\newcommand{\vone}{\vect{1}}
\newcommand{\vtwo}{\vect{2}}
\newcommand{\vthree}{\vect{3}}
\newcommand{\vfour}{\vect{4}}
\newcommand{\vfive}{\vect{5}}

\texor@fonts@alphabet{v}{vect}   % vectors
\texor@fonts@alphabet{h}{hat}    % vectors with hats!
\texor@fonts@alphabet{H}{hatt}   % bold vectors with hats!
\texor@fonts@alphabet{iv}{ivect} % italic vectors
\texor@fonts@alphabet{iH}{ihatt} % italic vectors with hats!
\texor@fonts@alphabet{L}{lie}    % fracktur (lie)
\texor@fonts@alphabet{C}{cat}    % calligraphy
\texor@fonts@alphabet{f}{fld}    % black board
%\texor@fonts@alphabet{s}{snf}
 
% Greek %
% a b g d e z  h th i k l m  n x o p r s  t u ph ch ps om

\newcommand{\al}{\alpha}
\newcommand{\be}{\beta}
\newcommand{\ga}{\gamma}
\newcommand{\de}{\delta}
\newcommand{\ep}{\varepsilon}
\newcommand{\ze}{\zeta}
\newcommand{\et}{\eta}
\newcommand{\te}{\theta}
\newcommand{\io}{\iota}
\newcommand{\ka}{\kappa}
\newcommand{\la}{\lambda}
% mu
% nu
\newcommand{\on}{\texor@fonts@choice[math-roman]{o}}
% xi
% pi
\newcommand{\rh}{\rho}
\newcommand{\si}{\sigma}
% tau
\newcommand{\ups}{\upsilon}
\newcommand{\ph}{\varphi}
% chi
\newcommand{\ps}{\psi}
\newcommand{\om}{\omega}

\newcommand{\vte}{\vartheta}
\newcommand{\vka}{\varkappa}
\newcommand{\vsi}{\varsigma}
\newcommand{\vep}{\epsilon}
\newcommand{\vps}{\varpsi}
\newcommand{\vrh}{\varrho}
\newcommand{\vpi}{\varpi}

\newcommand{\Al}{\texor@fonts@choice[math-roman]{A}}
\newcommand{\Be}{\texor@fonts@choice[math-roman]{B}}
\newcommand{\Ga}{\Gamma}
\newcommand{\De}{{\mathchoice
    {\hstretch{0.8}{\Delta}}
    {\hstretch{0.8}{\Delta}}
    {\hstretch{0.7}{\Delta}}
    {\hstretch{0.7}{\Delta}}}}
\newcommand{\Ze}{\texor@fonts@choice[math-roman]{Z}}
\newcommand{\Et}{\texor@fonts@choice[math-roman]{H}}
\newcommand{\Ep}{\texor@fonts@choice[math-roman]{E}}
\newcommand{\Te}{\Theta}
\newcommand{\Io}{\texor@fonts@choice[math-roman]{I}}
\newcommand{\Ka}{\texor@fonts@choice[math-roman]{K}}
\newcommand{\lla}{\Lambda}
\newcommand{\LLa}{\Lambda}
\newcommand{\Mu}{\texor@fonts@choice[math-roman]{M}}
\newcommand{\Nu}{\texor@fonts@choice[math-roman]{N}}
\newcommand{\On}{\texor@fonts@choice[math-roman]{O}}
% Xi
% Pi
\newcommand{\Rh}{\texor@fonts@choice[math-roman]{P}}
\newcommand{\Si}{\Sigma}
\newcommand{\Tau}{\texor@fonts@choice[math-roman]{T}}
\newcommand{\Ups}{\Upsilon}
\newcommand{\Ph}{\Phi}
\newcommand{\Chi}{\texor@fonts@choice[math-roman]{X}}
\newcommand{\Ps}{\Psi}
\newcommand{\Om}{\Omega}

\newcommand{\vGa}{\varGamma}
\newcommand{\vDe}{{\mathchoice
    {\hstretch{0.8}{\varDelta}}
    {\hstretch{0.8}{\varDelta}}
    {\hstretch{0.7}{\varDelta}}
    {\hstretch{0.7}{\varDelta}}}}
\newcommand{\vLa}{\varLambda}
\newcommand{\vTe}{\varTheta}
\newcommand{\vSi}{\varSigma}
\newcommand{\vOm}{\varOmega}
\newcommand{\vPs}{\varPsi}
\newcommand{\vXi}{\varXi}
\newcommand{\vPh}{\varPhi}
\newcommand{\vPi}{\varPi}

\let\bignabla\nabla
\def\nabla{{\mathchoice
    {\hstretch{0.8}{\bignabla}}
    {\hstretch{0.8}{\bignabla}}
    {\hstretch{0.7}{\bignabla}}
    {\hstretch{0.7}{\bignabla}}}}
\def\vnabla{\nabla}

% Misc %

\newcommand{\ii}{\imath}
\newcommand{\jj}{\jmath}

%% Common Variables %%

\let\pilcrow\P

%%% Operators %%%

\newcommand{\dispfrac}[2]{\frac{\displaystyle{#1}}{\displaystyle{#2}}}

%% witchcraft for extracting operator names %%
\begingroup\lccode`\|=`\\
\lowercase{\endgroup\def\removebs#1{\if#1|\else#1\fi}}
\newcommand{\texor@macro@name}[1]{\expandafter\removebs\string#1}

% Big operators macros %

\newcommand{\newbigop}[2]{%
    \expandafter\DeclareRobustCommand{#1}{%
        \mathop{\vphantom{\sum}\expandafter\mathpalette\csname\texor@macro@name{#1}@bigop\endcsname\relax}\slimits@
    }

    \expandafter\newcommand\csname\texor@macro@name{#1}@bigop\endcsname[2]{%
        \vcenter{%
            \sbox\z@{$##1\sum$}%
            \hbox{\resizebox{.9\dimexpr\ht\z@+\dp\z@}{!}{$\ThisStyle{##1}\m@th#2$}}%
        }%
    }
}

\newcommand{\texor@oper@names@new}[2][]{
    \expandafter\newcommand\csname texor@oper@internal@\texor@macro@name{#2}@#1\endcsname%{#3}
}

\newcommand{\texor@oper@names@renew}[2][]{
    \expandafter\renewcommand\csname texor@oper@internal@\texor@macro@name{#2}@#1\endcsname%{#3}
}

\newcommand{\texor@oper@names@declare}[2][]{
    \expandafter\DeclareDocumentCommand\csname texor@oper@internal@\texor@macro@name{#2}@#1\endcsname%{#3}
}

\newcommand{\texor@oper@names@call}[2][]{
    \csname texor@oper@internal@\texor@macro@name{#2}@#1\endcsname
}

\newcommand{\texor@oper@new@delim}[3]{
    \providecommand{#1}{1}
    \renewcommand{#1}[2][]{{\left#2##2\right#3}\texor@exists{##1}{_{##1}}{}}
}

\newcommand{\texor@oper@new@delim@wide}[4]{
    \providecommand{#1}{1}
    %\texor@oper@names@new[left]{#1}{#2}
    %\texor@oper@names@new[middle]{#1}{#3}
    %\texor@oper@names@new[right]{#1}{#4}
    \renewcommand{#1}[3][]{{\left#2##2\,\middle#3\,##3\right#4}\texor@exists{##1}{_{##1}}{}}
}

\newcommand{\TexorDelimiter}{\texor@ifnext{\texor@oper@new@delim@wide}{\texor@oper@new@delim}}

\newcommand{\texor@oper@aux@par}[1]{\texor@exists{#1}{\!\Par{#1}}{}}
\newcommand{\texor@oper@aux@par@plain}[1]{\texor@exists{#1}{\Par{#1}}{}}

\newcommand{\texor@oper@new@twoscript@commands}[3]{
    \providecommand{#2}{1}
    \texor@oper@names@new{#2}{#3}
    \texor@oper@names@declare[lower]{#2}{ O{} O{} O{} }{
        \mathop{\texor@exists{##1}{
            \texor@exists{##2}{
                \texor@fonts@call{#1}{\texor@oper@names@call{#2}}_{##1}^{##2}
            }{
                \texor@fonts@call{#1}{\texor@oper@names@call{#2}}_{##1}
            }
        }{
            \texor@exists{##2}{
                \texor@fonts@call{#1}{\texor@oper@names@call{#2}}^{##2}
            }{
                \texor@fonts@call{#1}{\texor@oper@names@call{#2}}_{}
            }
        }}\nolimits\texor@oper@aux@par{##3}
    }
    \texor@oper@names@declare[upper]{#2}{ O{} O{} O{} }{
        \texor@oper@names@call[lower]{#2}[##2][##1][##3]
    }
}

\newcommand{\texor@oper@new@twoscript@unstar}[3][text-roman]{
    \texor@oper@new@twoscript@commands{#1}{#2}{#3}
    \renewcommand{#2}{\texor@ifnext{\texor@oper@names@call[upper]{#2}}{\texor@oper@names@call[lower]{#2}}}
}

\newcommand{\texor@oper@new@twoscript@star}[3][text-roman]{
    \texor@oper@new@twoscript@commands{#1}{#2}{#3}
    \renewcommand{#2}{\texor@ifnext{\texor@oper@names@call[lower]{#2}}{\texor@oper@names@call[upper]{#2}}}
}

\newcommand{\TexorTwoScriptOp}{\texor@ifnext{\texor@oper@new@twoscript@star}{\texor@oper@new@twoscript@unstar}}

\newcommand{\texor@oper@new@onescript@commands}[3]{
    \providecommand{#2}{1}
    \texor@oper@names@new{#2}{#3}
    \texor@oper@names@declare[lower]{#2}{ O{} O{} }{
        \mathop{\texor@exists{##1}{
            \texor@fonts@call{#1}{\texor@oper@names@call{#2}}_{##1}
        }{
            \texor@fonts@call{#1}{\texor@oper@names@call{#2}}_{}
        }}\nolimits\texor@oper@aux@par{##2}
    }
    \texor@oper@names@declare[upper]{#2}{ O{} O{} }{
        \mathop{\texor@exists{##1}{
            \texor@fonts@call{#1}{\texor@oper@names@call{#2}}^{##1}
        }{
            \texor@fonts@call{#1}{\texor@oper@names@call{#2}}^{}
        }}\nolimits\texor@oper@aux@par{##2}
    }
}

\newcommand{\texor@oper@new@onescript@unstar}[3][text-roman]{
    \texor@oper@new@onescript@commands{#1}{#2}{#3}
    \renewcommand{#2}{\texor@ifnext{\texor@oper@names@call[upper]{#2}}{\texor@oper@names@call[lower]{#2}}}
}

\newcommand{\texor@oper@new@onescript@star}[3][text-roman]{
    \texor@oper@new@onescript@commands{#1}{#2}{#3}
    \renewcommand{#2}{\texor@ifnext{\texor@oper@names@call[lower]{#2}}{\texor@oper@names@call[upper]{#2}}}
}

\newcommand{\TexorOneScriptOp}{\texor@ifnext{\texor@oper@new@onescript@star}{\texor@oper@new@onescript@unstar}}

\newcommand{\texor@oper@new@plain}[3][text-roman]{
    \providecommand{#2}{1}
    \texor@oper@names@new{#2}{#3}
    \texor@oper@names@declare[command]{#2}{ O{} }{
        \mathop{\texor@fonts@call{#1}{\texor@oper@names@call{#2}}_{}}\nolimits
        \texor@oper@aux@par{##1}
    }
    \renewcommand{#2}{\texor@oper@names@call[command]{#2}}
}

\newcommand{\TexorMathOp}{\texor@oper@new@plain}

\newcommand{\texor@oper@new@limit}[3][text-roman]{
    \providecommand{#2}{1}
    \texor@oper@names@new{#2}{#3}
    \texor@oper@names@declare[normal]{#2}{ O{} }{
        \mathop{\texor@fonts@call{#1}{\texor@oper@names@call{#2}}_{}}
        \texor@oper@aux@par{##1}
    }
    \texor@oper@names@declare[under]{#2}{ O{} O{} }{
        \texor@exists{##1}{
            \mathop{\texor@fonts@call{#1}{\texor@oper@names@call{#2}}}_{##1}
        }{
            \mathop{\texor@fonts@call{#1}{\texor@oper@names@call{#2}}_{}}
        }
        \texor@oper@aux@par{##2}
    }
    \renewcommand{#2}{\texor@ifnext{\texor@oper@names@call[under]{#2}}{\texor@oper@names@call[normal]{#2}}}
}

\newcommand{\TexorLimitOp}{\texor@oper@new@limit}

\newcommand{\texor@oper@new@prefix@commands}[3]{
    \providecommand{#2}{1}
    \texor@oper@names@new{#2}{#3}
    \texor@oper@names@declare[lower]{#2}{ O{} O{} }{
        {\texor@exists{##1}{
            \texor@fonts@call{#1}{\texor@oper@names@call{#2}}_{##1}
        }{
            \texor@fonts@call{#1}{\texor@oper@names@call{#2}}_{}
        }}\texor@oper@aux@par{##2}
    }
    \texor@oper@names@declare[upper]{#2}{ O{} O{} }{
        {\texor@exists{##1}{
            \texor@fonts@call{#1}{\texor@oper@names@call{#2}}^{##1}
        }{
            \texor@fonts@call{#1}{\texor@oper@names@call{#2}}^{}
        }}\texor@oper@aux@par{##2}
    }
}

\newcommand{\texor@oper@new@prefix@unstar}[3][text-roman]{
    \texor@oper@new@prefix@commands{#1}{#2}{#3}
    \renewcommand{#2}{\texor@ifnext{\texor@oper@names@call[upper]{#2}}{\texor@oper@names@call[lower]{#2}}}
}

\newcommand{\texor@oper@new@prefix@star}[3][text-roman]{
    \texor@oper@new@prefix@commands{#1}{#2}{#3}
    \renewcommand{#2}{\texor@ifnext{\texor@oper@names@call[lower]{#2}}{\texor@oper@names@call[upper]{#2}}}
}

\newcommand{\TexorPrefixOp}{\texor@ifnext{\texor@oper@new@prefix@star}{\texor@oper@new@prefix@unstar}}

\newcommand{\texor@oper@new@script@commands}[3]{
    \providecommand{#2}{1}
    \texor@oper@names@new{#2}{#3}
    \texor@oper@names@declare[lower]{#2}{ m }{
        ##1_{\texor@fonts@call{#1}{\texor@oper@names@call{#2}}}
    }
    \texor@oper@names@declare[upper]{#2}{ m }{
        ##1^{\texor@fonts@call{#1}{\texor@oper@names@call{#2}}}
    }
}

\newcommand{\texor@oper@new@script@unstar}[3][text-roman]{
    \texor@oper@new@script@commands{#1}{#2}{#3}
    \renewcommand{#2}{\texor@ifnext{\texor@oper@names@call[lower]{#2}}{\texor@oper@names@call[upper]{#2}}}
}

\newcommand{\texor@oper@new@script@star}[3][text-roman]{
    \texor@oper@new@script@commands{#1}{#2}{#3}
    \renewcommand{#2}{\texor@ifnext{\texor@oper@names@call[upper]{#2}}{\texor@oper@names@call[lower]{#2}}}
}

\newcommand{\TexorScriptOp}{\texor@ifnext{\texor@oper@new@script@star}{\texor@oper@new@script@unstar}}

\newcommand{\TexorSuffixOp}[3][math-roman]{
    \providecommand{#2}{1}
    \texor@oper@names@new{#2}{#3}
    \renewcommand{#2}[1]{{##1\text{-}\texor@fonts@call{#1}{\texor@oper@names@call{#2}}}}
}

\newcommand{\TexorUnderOp}[2]{
    \providecommand{#1}{1}
    \texor@oper@names@new{#1}{#2}
    \renewcommand{#1}[1][]{
        \mathbin{\texor@exists{##1}
        {\mathchoice
            {\underset{##1}{\texor@oper@names@call{#1}}}
            {\texor@oper@names@call{#1}_{##1}}
            {\texor@oper@names@call{#1}_{##1}}
            {\texor@oper@names@call{#1}_{##1}}
        }
        {\texor@oper@names@call{#1}}}
    }
}

\newcommand{\texor@oper@cat@hom}[1]{\texor@exists{#1}{\Par{#1}}{}}
\newcommand{\texor@oper@cat@left}[1]{\texor@exists{#1}{#1\text{-}}{}}
\newcommand{\texor@oper@cat@right}[1]{\texor@exists{#1}{\text{-}#1}{}}

\DeclareDocumentCommand{\TexorCategory}{ O{} O{} m }{
    \def\texor@oper@cat@name{\texor@exists{#2}{\texor@macro@name{#2}}{c#3}}
    \message{\texor@oper@cat@name}
    \switch{#1}{
        \case{}{
            \expandafter\DeclareDocumentCommand
                \csname\texor@oper@cat@name\endcsname
                { O{} }
                {\namedCat{#3}\texor@oper@cat@hom{##1}}
        }
        \case{left}{
            \expandafter\DeclareDocumentCommand
                \csname\texor@oper@cat@name\endcsname
                { O{} O{} }
                {\texor@oper@cat@left{##1}\namedCat{#3}\texor@oper@cat@hom{##2}}
        }
        \case{right}{
            \expandafter\DeclareDocumentCommand
                \csname\texor@oper@cat@name\endcsname
                { O{} O{} }
                {\namedCat{#3}\texor@oper@cat@right{##1}\texor@oper@cat@hom{##2}}
        }
        \case{sub}{
            \expandafter\DeclareDocumentCommand
                \csname\texor@oper@cat@name\endcsname
                { O{} O{} }
                {\namedCat{#3}_{##1}\texor@oper@cat@hom{##2}}
        }
        \case{sup}{
            \expandafter\DeclareDocumentCommand
                \csname\texor@oper@cat@name\endcsname
                { O{} O{} }
                {\namedCat{#3}^{##1}\texor@oper@cat@hom{##2}}
        }
        \case{left-sub}{
            \expandafter\DeclareDocumentCommand
                \csname\texor@oper@cat@name\endcsname
                { O{} O{} O{} }
                {\texor@oper@cat@left{##1}\namedCat{#3}_{##2}\texor@oper@cat@hom{##3}}
        }
        \case{right-sub}{
            \expandafter\DeclareDocumentCommand
                \csname\texor@oper@cat@name\endcsname
                { O{} O{} O{} }
                {\namedCat{#3}_{##2}\texor@oper@cat@right{##1}\texor@oper@cat@hom{##3}}
        }
        \case{left-sup}{
            \expandafter\DeclareDocumentCommand
                \csname\texor@oper@cat@name\endcsname
                { O{} O{} O{} }
                {\texor@oper@cat@left{##1}\namedCat{#3}^{##2}\texor@oper@cat@hom{##3}}
        }
        \case{right-sup}{
            \expandafter\DeclareDocumentCommand
                \csname\texor@oper@cat@name\endcsname
                { O{} O{} O{} }
                {\namedCat{#3}^{##2}\texor@oper@cat@right{##1}\texor@oper@cat@hom{##3}}
        }
        \case{sub-left}{
            \expandafter\DeclareDocumentCommand
                \csname\texor@oper@cat@name\endcsname
                { O{} O{} O{} }
                {\texor@oper@cat@left{##2}\namedCat{#3}_{##1}\texor@oper@cat@hom{##3}}
        }
        \case{sub-right}{
            \expandafter\DeclareDocumentCommand
                \csname\texor@oper@cat@name\endcsname
                { O{} O{} O{} }
                {\namedCat{#3}_{##1}\texor@oper@cat@right{##2}\texor@oper@cat@hom{##3}}
        }
        \case{sup-left}{
            \expandafter\DeclareDocumentCommand
                \csname\texor@oper@cat@name\endcsname
                { O{} O{} O{} }
                {\texor@oper@cat@left{##2}\namedCat{#3}^{##1}\texor@oper@cat@hom{##3}}
        }
        \case{sup-right}{
            \expandafter\DeclareDocumentCommand
                \csname\texor@oper@cat@name\endcsname
                { O{} O{} O{} }
                {\namedCat{#3}^{##1}\texor@oper@cat@right{##2}\texor@oper@cat@hom{##3}}
        }
        \case{left-right}{
            \expandafter\DeclareDocumentCommand
                \csname\texor@oper@cat@name\endcsname
                { O{} O{} O{} }
                {\texor@oper@cat@left{##1}\namedCat{#3}\texor@oper@cat@right{##2}
                    \texor@oper@cat@hom{##3}}
        }
        \case{par}{
            \expandafter\DeclareDocumentCommand
                \csname\texor@oper@cat@name\endcsname
                { O{} O{} }
                {\namedCat{#3}\texor@oper@cat@hom{##1}\texor@oper@cat@hom{##2}}
        }
    }
    
}

%% Delimiters %%

\TexorDelimiter{\Par}{(}{)}
\TexorDelimiter{\Squ}{[}{]}
\TexorDelimiter{\Cur}{\{}{\}}

\TexorDelimiter{\PSqu}{(}{]}
\TexorDelimiter{\SPar}{[}{)}

\TexorDelimiter{\Ang}{\langle}{\rangle}
\TexorDelimiter{\gnA}{\rangle}{\langle}
\TexorDelimiter{\Bra}{\langle}{|}
\TexorDelimiter{\Ket}{|}{\rangle}

\TexorDelimiter{\Abs}{|}{|}
\TexorDelimiter{\Nor}{\Vert}{\Vert}
\newcommand{\Norp}{\Nor[\rmn{op}]}

\TexorDelimiter{\Flo}{\lfloor}{\rfloor}
\TexorDelimiter{\Ceil}{\lceil}{\rceil}

\TexorDelimiter*{\mkset}{\{}{|}{\}}
\TexorDelimiter*{\BraKet}{\langle}{|}{\rangle}

\TexorDelimiter{\restr}{.}{|}
\TexorDelimiter*{\Quot}{.}{/}{.}

%% Number Systems %%

\TexorOneScriptOp{\F}{\fF}   % finite field
\TexorOneScriptOp*{\N}{\fN}   % naturals
\TexorOneScriptOp*{\Z}{\fZ}   % integers
\TexorOneScriptOp*{\Q}{\fQ}   % rationals
\TexorOneScriptOp*{\R}{\fR}   % reals
\TexorOneScriptOp*{\C}{\fC}   % complexes

\TexorOneScriptOp*{\H}{\fH}   % quaternions, half-plane

%% Special Spaces %%

\TexorOneScriptOp*{\Rp}{\fR\fP}
\TexorOneScriptOp*{\Cp}{\fC\fP}

\TexorOneScriptOp*{\Sph}{S}  % sphere
\TexorTwoScriptOp*{\Dsk}{\fD} % disk
\TexorTwoScriptOp*{\Trs}{\fT} % torus
\TexorTwoScriptOp*{\Sol}{\fS} % solenoid

\TexorTwoScriptOp*{\Af}{\fA} % affine K-space
\TexorTwoScriptOp*{\Pr}{\fP} % projective K-space

%% Special Groups %%

\TexorOneScriptOp{\Sg}{\Si} % symmetric group

\TexorOneScriptOp{\Zad}{\fZ}   % p-adic integers
\TexorOneScriptOp{\Qad}{\fQ}   % p-adic rationals

\newcommand{\Zp}[1][p]{\fZ/#1} % cyclic groups

\newcommand{\Zpro}{\widehat{\Z}} % profinite integers
\TexorOneScriptOp*{\Spro}{\widehat{\fS}} % profinite solenoid

\newcommand{\Zpru}[1][p]{\Z_{#1^\infty}} % Pruffer group

\TexorOneScriptOp{\Adl}{\fA} % adele
\TexorOneScriptOp{\Idl}{\fI} % idele

\TexorOneScriptOp{\OK}{\CO} % integer ring

\TexorOneScriptOp{\GL}{GL} % general linear group
\TexorOneScriptOp{\SL}{SL} % special linear group
\TexorOneScriptOp{\SO}{SO} % special orthogonal group
\TexorOneScriptOp{\sO}{O}  % orthogonal group
\TexorOneScriptOp{\SU}{SU} % special unitary group
\TexorOneScriptOp{\sU}{U}  % unitary group
\TexorOneScriptOp{\PSL}{PSL} % projective special linear group
\TexorOneScriptOp{\Mat}{M} % matrix algebra

% lie algebras thereof
\TexorOneScriptOp{\lGL}{\lie{gl}}
\TexorOneScriptOp{\lSL}{\lie{sl}}
\TexorOneScriptOp{\lSO}{\lie{so}}
\TexorOneScriptOp{\lsO}{\lie{o}}
\TexorOneScriptOp{\lSU}{\lie{su}}
\TexorOneScriptOp{\lsU}{\lie{u}}
\TexorOneScriptOp{\lMat}{\lie{m}}

%% Imaginary units and constants %%
\newcommand{\qI}{\cat{i}} % quaternion i
\newcommand{\qJ}{\cat{j}} % quaternion j
\newcommand{\qK}{\cat{k}} % quaternion k
\newcommand{\I}{\qI}      % imaginary unit

\newcommand{\euler}{\bm{e}} % Euler's constant


%% Trig %%

\TexorMathOp{\sin}{sin} % sine
\TexorMathOp{\cos}{cos} % cosine
\TexorMathOp{\tan}{tan} % tangent
\TexorMathOp{\csc}{csc} % cosecant
\TexorMathOp{\sec}{sec} % secant
\TexorMathOp{\cot}{cot} % cotangent

\TexorOneScriptOp*{\sinn}{sin}
\TexorOneScriptOp*{\cosn}{cos}
\TexorOneScriptOp*{\tann}{tan}
\TexorOneScriptOp*{\cscn}{csc}
\TexorOneScriptOp*{\secn}{sec}
\TexorOneScriptOp*{\cotn}{cot}

\TexorMathOp{\arcsin}{arcsin}
\TexorMathOp{\arccos}{arccos}
\TexorMathOp{\arctan}{arctan}
\TexorMathOp{\arccsc}{arccsc}
\TexorMathOp{\arcsec}{arcsec}
\TexorMathOp{\arccot}{arccot}

%% Hyperbolic Trig %%

\TexorMathOp{\sinh}{sinh}
\TexorMathOp{\cosh}{cosh}
\TexorMathOp{\tanh}{tanh}
\TexorMathOp{\csch}{csch}
\TexorMathOp{\sech}{sech}
\TexorMathOp{\coth}{coth}

\TexorOneScriptOp*{\sinhn}{sinh}
\TexorOneScriptOp*{\coshn}{cosh}
\TexorOneScriptOp*{\tanhn}{tanh}
\TexorOneScriptOp*{\cschn}{csch}
\TexorOneScriptOp*{\sechn}{sech}
\TexorOneScriptOp*{\cothn}{coth}

\TexorMathOp{\arcsinh}{arcsinh}
\TexorMathOp{\arccosh}{arccosh}
\TexorMathOp{\arctanh}{arctanh}
\TexorMathOp{\arccsch}{arccsch}
\TexorMathOp{\arcsech}{arcsech}
\TexorMathOp{\arccoth}{arccoth}

%% Log and Exp %%

\TexorMathOp{\log}{log}     % logarithm
\TexorMathOp{\arg}{arg}     % complex argument

\TexorMathOp{\ln}{ln}       % natural log
\TexorMathOp{\lb}{lb}       % binary log
\TexorOneScriptOp{\logn}{log} % arbitrary base log

\newcommand{\E}[1]{\euler^{#1}} % exponential
\TexorMathOp{\exp}{exp}           % exponential, operator form

% Misc Functions %

\TexorOneScriptOp{\const}{const} % constant map
\TexorMathOp{\ev}{ev}        % evaluation map
\TexorOneScriptOp{\pr}{pr}       % projection
\TexorOneScriptOp{\inc}{in}      % inclusion
\TexorMathOp{\Logi}{Li}      % log integral
\TexorMathOp{\erf}{erf}      % error function
\TexorOneScriptOp{\ind}{\fld{1}} % indicator func

%% Algebra %%
\TexorMathOp{\ker}{ker}     % kernel
\TexorMathOp{\img}{im}      % image
\TexorMathOp{\coker}{coker} % cokernel
\TexorMathOp{\coimg}{coim}  % coimage
\newcommand{\image}{\img} 
\TexorOneScriptOp{\gr}{gr}


% Linear %
\TexorMathOp{\rank}{rank}   % rank
\TexorMathOp{\nullsp}{null} % nullspace
\TexorOneScriptOp{\dim}{dim}  % dimension
\TexorMathOp{\det}{det}     % determinant
\TexorMathOp{\tr}{tr}       % trace
\TexorMathOp{\Span}{span}   % vector span
\TexorMathOp{\sign}{sign}   % sign
\TexorScriptOp{\transp}{T}  % transpose
\TexorScriptOp{\cotran}     % conjugate transpose
            {\dagger}
\TexorScriptOp{\dual}{\vee} % dual space
\TexorScriptOp{\adj}{*} % dual space

\TexorMathOp{\Bo}{\CB}
\TexorMathOp{\FR}{\CR}
\TexorMathOp{\Ko}{\CK}
\TexorMathOp{\HS}{HS}


\TexorTwoScriptOp{\Res}{Res}   % restricted representation
\TexorTwoScriptOp{\Ind}{Ind}   % induced representation
\TexorTwoScriptOp{\Tor}{Tor}   % Tor group
\TexorTwoScriptOp*{\Ext}{Ext}   % Ext group
\TexorMathOp{\Ann}{Ann}     % annihilator
\TexorMathOp{\Frac}{Frac}   % fraction field?
\TexorMathOp{\Char}{char}   % character, characteristic
\TexorMathOp{\Gal}{Gal}     % Galois group
\TexorMathOp{\Rad}{Rad}

\TexorScriptOp{\abel}{ab}      % abelianization
\TexorScriptOp{\units}{\times} % group of units
\TexorMathOp{\Cl}{Cl}          % ideal class group

\TexorPrefixOp*[math-ital]{\Tens}{\mathnormal{T}} % tensor power
\TexorPrefixOp*{\Symm}{Sym}         % symmetric power
\TexorPrefixOp*[math-ital]{\Extr}{\LLa}        % exterior power
      

\TexorScriptOp{\comp}{c}          % set complement
\TexorMathOp{\powset}{\CP}        % powerset
\newcommand{\eset}{\varnothing} % empty set
\newcommand{\pt}{\rmn{pt}}      % a point

\TexorLimitOp{\max}{max}
\TexorLimitOp{\min}{min}
\TexorLimitOp{\sup}{sup}
\TexorLimitOp{\inf}{inf}
\TexorLimitOp{\liminf}{lim\,inf}
\TexorLimitOp{\limsup}{lim\,sup}
\TexorLimitOp{\lim}{lim}

% extra fancy modulus
\undef{\mod}
\texor@oper@names@new{\mod}{\rmn{mod}}
\newcommand{\mod}[1][]{
    \texor@exists{#1}
        {\mathrel{\Par{\mathrel{\texor@oper@names@call{\mod}} #1}}}
        {\mathrel{\texor@oper@names@call{\mod}}}
}



% I'll be honest, I hate default \Re and \Im
\TexorMathOp{\Re}{\LR}
\TexorMathOp{\Im}{\LI}

%% Geometry %%
\TexorMathOp{\Spec}{Spec}

%% Number Theory %%
\TexorMathOp{\gcd}{gcd} % greatest common divisor
\TexorMathOp{\lcm}{lcm} % least common multiple

%% Categories %%
\TexorMathOp{\Hom}{Hom}   % homset
\TexorOneScriptOp{\HomX}{Hom} % homset with subscript
\TexorMathOp{\Endo}{End}  % endomorphism
\TexorOneScriptOp{\EndX}{End} % endomorphism
\TexorMathOp{\Aut}{Aut}   % automorphism

\TexorMathOp{\Obj}{obj}   % category objects
\TexorMathOp{\Mor}{mor}   % category morphisms
\TexorMathOp{\Dom}{dom}   % domain
\TexorMathOp{\Cod}{cod}   % codomain

\TexorOneScriptOp{\ide}{id} % identity

\TexorScriptOp{\opp}{op}    % opposite (category, ring)

\TexorOneScriptOp{\sk}{sk}     % skeleton
\TexorOneScriptOp{\cosk}{cosk} % coskeleton

\newcommand{\cotimes}{\amalg} % little coproduct
\TexorLimitOp{\Lim}{lim}      % lim
\TexorLimitOp{\Colim}{colim}  % colim

\TexorLimitOp{\HoLim}{holim}      % lim
\TexorLimitOp{\HoColim}{hocolim}  % colim

\newcommand{\Id}{\cat{id}}  % category identity map
\TexorMathOp{\Elmt}{Elmt}     % element category

\TexorPrefixOp[math-roman]{\Nrv}{N}         % nerve
\TexorPrefixOp[math-roman]{\hcat}{h}        % homotopy category
\TexorPrefixOp[math-bold]{\hCat}{h}      % homotopy 2-category

\TexorPrefixOp[math-bold]{\sCat}{\namedCat{s}} % simplex category?
\TexorPrefixOp[math-bold]{\ssCat}{\namedCat{ss}}

\TexorMathOp{\Map}{Map}

\TexorMathOp{\Fib}{Fib}     % fibrations
\TexorMathOp{\Cofib}{Cofib} % cofibrations
\TexorScriptOp*{\fobj}{f}   
\TexorScriptOp*{\cobj}{c}
\TexorScriptOp*{\cfobj}{cf}

\let\texor@oper@otimes\otimes
\let\texor@oper@times\times
\let\texor@oper@cup\cup
\let\texor@oper@cap\cap

\TexorUnderOp{\otimes}{\texor@oper@otimes}
\TexorUnderOp{\times}{\texor@oper@times}
\TexorUnderOp{\cotimes}{\amalg}

\TexorUnderOp{\cup}{\texor@oper@cup}
\TexorUnderOp{\cap}{\texor@oper@cap}

% Cats: Sets %
\TexorCategory{Set}        % sets / functions
\TexorCategory{Cls}        % classes / functions
\TexorCategory{Ens}        % ensambles / functions
\TexorCategory{Fin}        % finite sets / functions
\TexorCategory{Finord}     % finite ordinals / order-preserving functions
\TexorCategory{Ord}        % ordered sets / order-preserving maps
\TexorCategory{Rel}        % relations / relation-preserving maps

% Cats: Grps %
\TexorCategory{Mon}        % monoids / homomorphisms
\TexorCategory{Grp}        % groups / homomorphisms
\TexorCategory{Ab}         % abelian groups / homomorphisms
\TexorCategory{Rig}        % rigs / homomorphisms
\TexorCategory{Rng}        % rngs / homomorphisms
\TexorCategory{Ring}       % rings / homomorphisms
\TexorCategory{CRng}       % commutative rngs / homomorphisms
\TexorCategory{CRing}      % commutative rings / homomorphisms
\TexorCategory{Dom}        % integral domains / homomorphisms
\TexorCategory{Fld}        % fields / homomorphisms

\TexorCategory[left]{Mod}    % modules / linear maps
\TexorCategory[left-right][\cBiMod]{Mod}
\TexorCategory[right][\cRiMod]{Mod}          
\TexorCategory[par]{Ch}      % chains over a ring
\TexorCategory{GAb}
\TexorCategory[right]{GMod}  % graded modules / linear maps
\TexorCategory[right]{DGMod} % differential graded modules
\TexorCategory[left]{Alg}    % algebras / homomorphisms
\TexorCategory[left]{CAlg}   % commutative algebras / homomorphisms
\TexorCategory[sub]{Rep}     % representations / intertwiners
\TexorCategory[left-sub][\cLRep]{Rep}
\TexorCategory[sub]{Vct}     % vector spaces / linear maps
\TexorCategory[sub]{Vect}    % " / "

% Cats: Calc %
\TexorCategory{Met}        % metric spaces / metric-preserving maps
\TexorCategory{CMet}       % complete metric spaces / metric-preserving functions
\TexorCategory{Hil}        % Hilbert spaces
\TexorCategory{Ban}        % Banach spaces
\TexorCategory[left]{Lie}  % Lie groups/algebras
\TexorCategory{Man}        % manifolds
\TexorCategory{DMan}       % differentiable manifolds
\TexorCategory{SMan}       % smooth manifolds

% Cats: Cats %
\TexorCategory{Grph}   % graphs / morphisms of graphs
\TexorCategory{Quiv}   % quivers / morphisms of quivers
\TexorCategory{Cat}    % categories / functors
\TexorCategory{AbCat}  % Ab categories / additive functors
\TexorCategory{CAT}    % large categories / functors
\TexorCategory{Gpd}    % groupoids / homomorphisms
\TexorCategory{Moncat} % monoidal categories / monoidal functors
\TexorCategory{MCat}   % model categories / Quillen adjunctions
\TexorCategory{sSet}   % simplicial sets / functions
\TexorCategory{ssSet}         
\TexorCategory{sAb}           
\TexorCategory{ssAb}          
\TexorCategory{sCat}         

\TexorCategory{Map}
\TexorCategory{Maps}
\TexorCategory{Fun}
\TexorCategory{Func}
\TexorCategory{Funct}
\TexorCategory{End}
\TexorCategory{Aut}
\TexorCategory{Nat}
\TexorCategory{Cone} 
\TexorCategory{Cocone}
\TexorCategory[par][\Arr]{Arr} 

\TexorCategory[][\cCatad]{\cCat_{\rmn{ad}}} % adjunctions

% Cats: Tops $
\TexorCategory{Top}        % topological spaces / continuous maps
\TexorCategory[left][\cpTop]{Top}
\TexorCategory{Toph}       % topological spaces / maps modulo homotopy
\TexorCategory{Htpy}       % " / "
\TexorCategory{hTop}       % " / "
\TexorCategory{Haus}       % Hausdorff spaces
\TexorCategory{CHaus}      % compact Hausdorff spaces
\TexorCategory{CGHaus}     % compactly generated Hausdorff
\TexorCategory{CG}
\TexorCategory{Spaces}
\TexorCategory{LCA}        % locally compact abelian groups

\TexorCategory{Sch}        % schemes
\TexorCategory{Shf}        % sheaves
\TexorCategory{Var}        % varieties

\TexorCategory[par]{Open}  % open subsets / inclusions

\newcommand{\ckTop}{\cpTop[k]} % k-spaces

% Cats: Misc %
\TexorCategory[sub]{Matr}   % natural numbers / matrices

% simplex category
\newcommand{\texor@oper@standard@simplex}{\hstretch{0.8}{\varDelta}}
\TexorTwoScriptOp*{\cDe}{\texor@oper@standard@simplex}
\TexorTwoScriptOp*{\cHorn}{\vLa}

\TexorCategory[][\CDe]{\texor@oper@standard@simplex}
\DeclareDocumentCommand{\CDeop}{ O{} }{\opp{\CDe[#1]}}

% model category stuff
\newcommand{\rsim}{\mathbin{\overset{\rmn{R}}{\sim}}}
\newcommand{\lsim}{\mathbin{\overset{\rmn{L}}{\sim}}}

\TexorSuffixOp{\sinj}{inj}
\TexorSuffixOp{\sproj}{proj}
\TexorSuffixOp{\scof}{cof}
\TexorSuffixOp{\sfib}{fib}

\TexorSuffixOp{\scell}{cell}
  
%% Topology %%
\TexorMathOp{\Int}{Int}    % interior
\TexorMathOp{\Bd}{Bd}      % boundary
\TexorScriptOp{\op}{\circ} % interior?

\newcommand{\qsim}{{/{\sim}}} % mod an equivalence

\TexorMathOp{\Sing}{Sing} % singular simplicial set

\TexorOneScriptOp[math-ital]{\hmC}{C} % cellular chains

\TexorOneScriptOp[math-ital]{\hmS}{S} % simplices
\TexorOneScriptOp[math-ital]{\hmZ}{Z} % cycles
\TexorOneScriptOp[math-ital]{\hmB}{B} % boundaries
\TexorOneScriptOp[math-ital]{\hmH}{H} % homology

\TexorOneScriptOp[math-ital]{\hmrS}{\tl{S}} % reduced simplices
\TexorOneScriptOp[math-ital]{\hmrZ}{\tl{Z}} % reduced cycles
\TexorOneScriptOp[math-ital]{\hmrB}{\tl{B}} % reduced boundaries
\TexorOneScriptOp[math-ital]{\hmrH}{\tl{H}} % reduced homology

\TexorOneScriptOp[math-ital]{\Sti}{V} % steiffel manifold
\TexorOneScriptOp{\Gr}{Gr}             % grassmannian

\TexorPrefixOp*{\Loop}{\Om}
\TexorPrefixOp*{\Susp}{\Si}

\TexorOneScriptOp{\EndO}{\CE\!}

% POIncare group, i.e. homotopy group(iod)
\TexorOneScriptOp[1]{\poi}{\pi} 
\TexorOneScriptOp[1]{\Poi}{\Pi}

\TexorOneScriptOp*[math-ital]{\coC}{\mathnormal{C}} % cellular cochains

\TexorOneScriptOp*[math-ital]{\coS}{S} % cosimplices
\TexorOneScriptOp*[math-ital]{\coZ}{Z} % cocycles
\TexorOneScriptOp*[math-ital]{\coB}{B} % cobondaries
\TexorOneScriptOp*[math-ital]{\coH}{H} % cohomology

\TexorOneScriptOp{\Sin}{Sin}    % set of simplices
\TexorOneScriptOp*{\coSin}{Sin} % set of cosimplices
 
%% Analysis %% 
 
% this defines what dx actually looks like %
\newcommand{\diff}{\texor@fonts@call{text-roman}{\mathstrut d}}
 
% low-level tex for dx, via ISO-31 %
\providecommand*{\rawdiff}{\@ifnextchar^{\DIfF}{\DIfF^{}}}
\def\DIfF^#1{\mathop{\diff}\nolimits^{#1}\gobblespace}
\def\gobblespace{\futurelet\diffarg\opspace}
\def\opspace{
    \let\DiffSpace\!
    \ifx\diffarg(
        \let\DiffSpace\relax
    \else
        \ifx\diffarg[
            \let\DiffSpace\relax
        \else
            \ifx\diffarg\{
                \let\DiffSpace\relax
            \fi
        \fi
    \fi
    \DiffSpace
}
% %
 
\newcommand{\texor@oper@diff}[1][]{\rawdiff\texor@exists{#1}{^{#1}}{}}
\newcommand{\texor@oper@codiff}[1][]{\rawdiff\texor@exists{#1}{_{#1}}{}}
\newcommand{\D}{\@ifstar\texor@oper@codiff\texor@oper@diff} % derivatives
\newcommand{\DD}{\texor@fonts@call{math-roman}{D}}
\newcommand{\del}{\partial}

% Leibniz notation
% \leib[2]{d}{f}{x} -> (d^2 f)/dx^2
\providecommand*{\leib}[4][]{\frac{#2^{#1}#3}{#2 #4^{#1}}}

\newcommand{\od}[3][]{\leib[#1]{\D}{#2}{#3}}
\newcommand{\Dd}[3][]{\leib[#1]{\DD}{#2}{#3}}
\newcommand{\pd}[3][]{\leib[#1]{\del}{#2}{#3}}

\newcommand{\Dx}{\D x}
\newcommand{\Dy}{\D y}
\newcommand{\Dt}{\D t}

% nth derivative
\newcommand{\Nd}[2]{#2^{\Par{#1}}}
\TexorOneScriptOp{\res}{res}

\let\@iint\varoiint
\let\varoiint\oiint
\let\oiint\@iint

\TexorOneScriptOp*{\lsp}{\ell} % l-space of sequences
\TexorOneScriptOp*{\Lsp}{L\!}  % L-space of functions
\TexorOneScriptOp*{\Lbg}{\CL}  % Lebesgue integrable funcs
\TexorOneScriptOp*{\Cnt}{\CC}  % continuous funcs
\TexorMathOp{\Csp}{\CC_{\texor@fonts@call{text-roman}{c}}} % cont w/ compact support

\newcommand{\Mel}{\CM\Cur} % Mellin transform

\DeclareDocumentCommand{\Mel}{ O{} O{} }{
    \CM\texor@exists{#1}{\Cur{#1}}{}\texor@exists{#2}{\Par{#2}}{}
}
 
\TexorMathOp{\len}{len}     % length
\TexorMathOp{\vol}{vol}     % volume
\TexorMathOp{\covol}{covol} % covolume

%% Vect Calc %%
\TexorMathOp{\grad}{grad} % gradient
\TexorMathOp{\dive}{div}  % divergence
\TexorMathOp{\curl}{curl} % curl

\TexorMathOp{\Grad}{\vnabla}
\TexorMathOp{\Dive}{\vnabla\cdot}
\TexorMathOp{\Curl}{\vnabla\times}
\TexorMathOp{\laplace}{\vnabla^2}

%% Big Operators %%

\let\texor@sym@bigstar\bigstar
\def\fatstar{\mathbin{\scalerel*{\texor@sym@bigstar}{\ThisStyle{}\times}}}

\newbigop{\bigstar}{\star}       % five-pointed star
\newbigop{\bigast}{\ast}         % six-pointed star
\newbigop{\bigfatstar}{\fatstar} % fat five-pointed star

\newcommand{\texor@sym@smash@display}{%
\begin{tikzpicture}[rotate=45,x=0.5ex,y=0.5ex]
\draw[line width=.095ex, line cap=round] (0,2) -- (3,2) (0,1) -- (3,1) (1,3) -- (1,0) (2,3) -- (2,0);
\end{tikzpicture}
}
\newcommand{\texor@sym@smash@other}{%
\begin{tikzpicture}[rotate=45,x=0.5ex,y=0.5ex]
\draw[line width=.12ex, line cap=round] (0,2) -- (3,2) (0,1) -- (3,1) (1,3) -- (1,0) (2,3) -- (2,0);
\end{tikzpicture}
}

\newcommand{\texor@sym@conn@display}{%
\begin{tikzpicture}[x=0.7ex,y=0.7ex]
\draw[line width=.095ex, line cap=round] (0.5,2) -- (2.5,2) (0.5,1) -- (2.5,1) (1,3) -- (1,0) (2,3) -- (2,0);
\end{tikzpicture}
}

\newcommand{\texor@sym@conn@other}{%
\begin{tikzpicture}[x=0.5ex,y=0.5ex]
\draw[line width=.11ex, line cap=round] (0.5,2) -- (2.5,2) (0.5,1) -- (2.5,1) (1,3) -- (1,0) (2,3) -- (2,0);
\end{tikzpicture}
}

\newcommand{\smashtimes} % # at a 45 deg angle
    {\mathbin{\texor@sym@smash@other}}

\newcommand{\connplus}   % # at a 90 deg angle
    {\mathbin{\texor@sym@conn@other}}

\newbigop{\bigsmash}{
    \mathchoice
        {\texor@sym@smash@display}
        {\texor@sym@smash@other}
        {\texor@sym@smash@other}
        {\texor@sym@smash@other}
    }

\newbigop{\bigconn}{
    \mathchoice
        {\texor@sym@conn@display}
        {\texor@sym@conn@other}
        {\texor@sym@conn@other}
        {\texor@sym@conn@other}
    }

\newcommand{\hash}{\mathbin{\#}}
\newbigop{\bighash}{\#}

\newcommand{\at}{\mathbin{\text{@}}}
\newbigop{\bigat}{\text{@}}

\newbigop{\bigdiv}{\div}

% completed direct sum
\newcommand{\hatplus}{\mathbin{\widehat{\oplus}}}
\newcommand{\bighatplus}{\mathop{\widehat{\bigoplus}}}

\newcommand{\texor@sym@plus@display}{%
\begin{tikzpicture}
\draw[line width=.4ex, line cap=round] (0,0) -- (1,0) (0.5,-0.5) -- (0.5,0.5);
\end{tikzpicture}
}
\newcommand{\texor@sym@plus@other}{%
\begin{tikzpicture}
\draw[line width=0.6ex, line cap=round] (0,0) -- (1,0) (0.5,-0.5) -- (0.5,0.5);
\end{tikzpicture}
}

\newcommand{\texor@sym@times@display}{%
\begin{tikzpicture}[rotate=45,x=0.5ex,y=0.5ex]
\draw[line width=.065ex, line cap=round] (0,1.5) -- (3,1.5) (1.5,3) -- (1.5,0);
\end{tikzpicture}
}

\newcommand{\texor@sym@times@other}{%
\begin{tikzpicture}[rotate=45,x=0.5ex,y=0.5ex]
\draw[line width=.12ex, line cap=round] (0,1.5) -- (3,1.5) (1.5,3) -- (1.5,0);
\end{tikzpicture}
}

\newbigop{\bigplus}{
    \mathchoice
        {\texor@sym@plus@display}
        {\texor@sym@plus@other}
        {\texor@sym@plus@other}
        {\texor@sym@plus@other}
    }

\newbigop{\biprod}{\mathrlap{\prod}{\coprod}} % double product
\newcommand{\bitimes}{\mathbin{\mathrlap{\Pi}{\amalg}}} % double product

%% Wordz %%
\newcommand{\newword}{\@ifstar\@newwordstar\@newword}

\newcommand{\@newwordstar}[2]{\newcommand{#1}{\quad\mathrel{\text{#2}}\quad}}
\newcommand{\@newword}[2]{\newcommand{#1}{\mathrel{\text{#2}}}}

\newword{\AND}{and}
\newword{\OR}{or}
\newword{\XOR}{xor}
\newword{\IF}{if}
\newword{\IFF}{iff}
\newword{\ST}{s.t.}
\newword{\OTHER}{otherwise}
\newword{\UNLESS}{unless}
\newword{\ELSE}{else}
\newword{\IN}{in}
\newword{\FOR}{for}
\newword{\IRREP}{irrep}
\newword{\ELLIPTIC}{elliptic}
\newword{\PRIME}{prime}
\newword{\EVEN}{even}
\newword{\ODD}{odd}

\newword*{\qAND}{and}
\newword*{\qOR}{or}

%% Misc %%
\renewcommand{\to}{\rightarrow}
\newcommand{\To}{\Rightarrow}
\newcommand{\Tto}{\Rrightarrow}
\newcommand{\toto}{\rightrightarrows}
\newcommand{\from}{\leftarrow}
\newcommand{\From}{\Leftarrow}
\newcommand{\Ffrom}{\Lleftarrow}
\newcommand{\fromfrom}{\leftleftarrows}
\newcommand{\fromto}{\texor@delim@basearrow}
\newcommand{\FromTo}{\texor@delim@basearrow}
\newcommand{\up}{\uparrow}
\newcommand{\upup}{\upuparrows}
\newcommand{\down}{\downarrow}
\newcommand{\downdown}{\downdownarrows}
\newcommand{\toself}{\circlearrowright}

\newcommand{\inj}{\hookrightarrow}
\newcommand{\srj}{\rightarrow\!\!\!\!\!\!\!\rightarrow}

\renewcommand{\wto}{\rightharpoonup}

\newcommand{\acts}{\curvearrowright}
\newcommand{\acted}{\curvearrowleft}

\newcommand{\FirstWay}{\noindent($\Rightarrow$). }
\newcommand{\OtherWay}{\noindent($\Leftarrow$). }
\newcommand{\NWay}[2]{\noindent(#1) $\Leftarrow$ (#2). }

\newcommand{\nto}{\not\to}

\newcommand{\rmap}[1]{\xrightarrow{#1}}
\newcommand{\lmap}[1]{\xleftarrow{#1}}

\newcommand{\SES}[6][0]{#1 \to #2 \rmap{#3} #4 \rmap{#5} #6 \to #1}

% various containments
\newcommand{\nin}{\notin}
\newcommand{\subS}{\sbs}
\newcommand{\supS}{\sps}
\newcommand{\sbs}{\subset}
\newcommand{\sps}{\supset}
\newcommand{\nsubS}{\nsbs}
\newcommand{\nsupS}{\nsps}
\newcommand{\nsbs}{\subsetneq}
\newcommand{\nsps}{\supsetneq}

% special set minus
\newcommand{\sans}[1][]{\mathrel{\setminus}\texor@exists{#1}{\Cur{#1}}{}}
\newcommand{\sansz}{\sans[0]}

\newcommand{\@setminus@t}
    {\hbox{\tikz{\draw[line width=0.45pt,line cap=round] (3pt,0) -- (0,5pt);}}}
\newcommand{\@setminus@s}
    {\hbox{\tikz{\draw[line width=0.4pt,line cap=round] (2pt,0) -- (0,4pt);}}}
\newcommand{\@setminus@ss}
    {\hbox{\tikz{\draw[line width=0.35pt,line cap=round] (1.5pt,0) -- (0,3pt);}}}

\let\bigsetminus\setminus
\renewcommand{\setminus}
    {\mathbin{\mathchoice{\@setminus@t}{\@setminus@t}{\@setminus@s}{\@setminus@ss}}}

\let\@cong\cong
\newcommand{\isom}{\@cong}   % isomorphism
\newcommand{\homeo}{\@cong}  % homeomorphism
\newcommand{\htpy}{\simeq}   % homotopy
\renewcommand{\cong}{\equiv} % congruent
\newcommand{\isdef}{:=}      % definition

\newcommand{\ov}{\overline}  % overline (i.e. conjugate)
\newcommand{\un}{\underline} % underline
\newcommand{\tl}{\widetilde}     % tilde, twidle

\newcommand{\jacobi}[2]{\Par{\frac{#1}{#2}}} % jacobi symbol

%% Math table columns %%
\newcolumntype{C}{>{$}c<{$}}
\newcolumntype{R}{>{$}r<{$}}
\newcolumntype{L}{>{$}l<{$}}

%% Physics %%

\newcommand{\KE}{K\hspace{-0.6ex}E}
\newcommand{\rA}{\text{\normalfont\AA}}

\def\labar{\protect\texor@font@lambdabar}
\def\texor@font@lambdabar{%
\relax
\bgroup
\def\@tempa{\hbox{\raise.8\ht0
\hbox to0pt{\kern.15\wd0\vrule width.65\wd0
height.25pt depth.1pt\hss}\box0}}% 
\mathchoice{\setbox0\hbox{$\displaystyle\lambda$}\@tempa}%
{\setbox0\hbox{$\textstyle\lambda$}\@tempa}%
{\setbox0\hbox{$\scriptstyle\lambda$}\@tempa}%
{\setbox0\hbox{$\scriptscriptstyle\lambda$}\@tempa}%
\egroup
}

\def\ham{{\hat{\CH}}}

%% SI Inits %

\sisetup{
    inter-unit-product = \ensuremath{{}\cdot{}}
}

\providecommand{\texor@hook@postoperators}{}
\texor@hook@postoperators

%%% Pset templating %%%
%% TODO: make this a class

\newcommand{\psetSubject}[1]{\def\texor@pset@subject{#1}}
\def\texor@pset@subject{undefined}

\newcommand{\psetAuthor}[1]{\def\texor@pset@author{#1}}
\def\texor@pset@author{Miguel Young}

\newcommand{\psetNum}[1]{\def\texor@pset@num{#1}}
\def\texor@pset@num{undefined}

\newcommand{\psetCollabs}[1]{\def\texor@pset@collabs{Collaborators: #1}}
\def\texor@pset@collabs{}

\newcommand{\psetSources}[1]{\def\texor@pset@sources{Sources: #1}}
\def\texor@pset@sources{}

\newcommand{\psetTitle}[1]{%
    \newpage
    \begin{center}
        \makeatletter
        {\huge \texor@pset@subject{} Pset \texor@pset@num{} #1 }

        {\large \texor@pset@author}

        \ifthenelse{\equal{\texor@pset@collabs}{}}{}{Collaborators: \texor@pset@collabs}
        
        \ifthenelse{\equal{\texor@pset@sources}{}}{}{Sources: \texor@pset@sources}
        \makeatother
    \end{center}
}

\newcommand{\makePsetTitle}{\psetTitle{}}
\newcommand{\mkPsetTitle}{\makePsetTitle}

\pgfkeys{
    /pset/.is family, /pset,
        label/.estore in = \texor@pset@label,
        subject/.estore in = \texor@pset@subject,
        author/.estore in = \texor@pset@author,
        number/.estore in = \texor@pset@num,
        collabs/.estore in = \texor@pset@collabs,
        sources/.estore in = \texor@pset@sources,
        maketitle/.estore in = \texor@pset@maketitleQ,
    default/.style = {
        label = Pset,
        subject = 00.000, 
        author = {}, 
        number = 0, 
        collabs = {}, 
        sources = {},
        maketitle = true,
    },
}

\newcommand*{\texor@pset@roman}[1]{\expandafter\@slowromancap\romannumeral #1}

\newcommand{\pset}[1]{%
    \pgfkeys{/pset, default, #1}%
    \makeatletter%
    \title{\texor@pset@subject{} \texor@pset@label{} \texor@pset@roman{\texor@pset@num{}}}%
    \author{\texor@pset@author}%
    \texor@exists{\texor@pset@sources}{\blfootnote{Sources: \texor@pset@sources}}{}%
    \texor@exists{\texor@pset@collabs}{\blfootnote{Collaborators: \texor@pset@collabs}}{}%
    \ifthenelse{\equal{\texor@pset@maketitleQ}{true}}{\maketitle}{}%
    \makeatother%
}

\newcounter{texor@pset@prob}
\setcounter{texor@pset@prob}{0}
\newenvironment{psetProblem}{%
    \makeatletter
    \stepcounter{texor@pset@prob}
    \psetTitle{Problem \arabic{texor@pset@prob}}
    \makeatother
}{}

\newcommand{\blfootnote}[1]{%
  \begingroup
  \renewcommand\thefootnote{}\footnote{#1}%
  \addtocounter{footnote}{-1}%
  \endgroup
}

%%% Matrices %%%
%% Square %%

\newcommand{\bsing}[1]{
    \begin{bmatrix}
        \texor@exists@phantom{#1}
    \end{bmatrix}
}

\newcommand{\btwo}[4]{%
    \begin{bmatrix}
        \texor@exists@phantom{#1} & 
        \texor@exists@phantom{#2} \\ 
        #3 & #4 \\
    \end{bmatrix}
}

\newcommand{\bthree}[9]{%
    \begin{bmatrix}
        \texor@exists@phantom{#1} & 
        \texor@exists@phantom{#2} & 
        \texor@exists@phantom{#3} \\ 
        #4 & #5 & #6 \\
        #7 & #8 & #9 \\
    \end{bmatrix}
}

\newcommand{\Vbtwo}[2]{%
    \begin{bmatrix}
        \texor@exists@phantom{#1} \\ #2 \\
    \end{bmatrix}
}

\newcommand{\Hbtwo}[2]{%
    \begin{bmatrix}
        \texor@exists@phantom{#1} & 
        \texor@exists@phantom{#2}
    \end{bmatrix}
}

\newcommand{\Vbthree}[3]{%
    \begin{bmatrix}
        \texor@exists@phantom{#1} \\ #2 \\ #3 \\
    \end{bmatrix}
}



\newcommand{\Hbthree}[3]{%
    \begin{bmatrix}
        \texor@exists@phantom{#1} &
        \texor@exists@phantom{#2} & 
        \texor@exists@phantom{#3}
    \end{bmatrix}
}

\newcommand{\bdtwo}[2]{\btwo{#1}{}{}{#2}}
\newcommand{\bdthree}[3]{\bthree{#1}{}{}{}{#2}{}{}{}{#3}}

%% Round %%

\newcommand{\psing}[1]{
    \begin{pmatrix}
        \texor@exists@phantom{#1}
    \end{pmatrix}
}

\newcommand{\ptwo}[4]{%
    \begin{pmatrix}
        \texor@exists@phantom{#1} & 
        \texor@exists@phantom{#2} \\ 
        #3 & #4 \\
    \end{pmatrix}
}

\newcommand{\pthree}[9]{%
    \begin{pmatrix}
        \texor@exists@phantom{#1} & 
        \texor@exists@phantom{#2} & 
        \texor@exists@phantom{#3} \\ 
        #4 & #5 & #6 \\
        #7 & #8 & #9 \\
    \end{pmatrix}
}

\newcommand{\Vptwo}[2]{%
    \begin{pmatrix}
        \texor@exists@phantom{#1} \\ #2 \\
    \end{pmatrix}
}

\newcommand{\Hptwo}[2]{%
    \begin{pmatrix}
        \texor@exists@phantom{#1} & 
        \texor@exists@phantom{#2}
    \end{pmatrix}
}
\newcommand{\Vpthree}[3]{%
    \begin{pmatrix}
        \texor@exists@phantom{#1} \\ #2 \\ #3 \\
    \end{pmatrix}
}

\newcommand{\Hpthree}[3]{%
    \begin{pmatrix}
        \texor@exists@phantom{#1} & 
        \texor@exists@phantom{#2} &
        \texor@exists@phantom{#3}
    \end{pmatrix}
}

\newcommand{\pdtwo}[2]{\ptwo{#1}{}{}{#2}}
\newcommand{\pdthree}[3]{\pthree{#1}{}{}{}{#2}{}{}{}{#3}}

%% Vert %%

\newcommand{\vsing}[1]{
    \begin{vmatrix}
        \texor@exists@phantom{#1}
    \end{vmatrix}
}

\newcommand{\Vtwo}[4]{%
    \begin{vmatrix}
        \texor@exists@phantom{#1} & 
        \texor@exists@phantom{#2} \\ 
        #3 & #4 \\
    \end{vmatrix}
}

\newcommand{\Vthree}[9]{%
    \begin{vmatrix}
        \texor@exists@phantom{#1} & 
        \texor@exists@phantom{#2} & 
        \texor@exists@phantom{#3} \\ 
        #4 & #5 & #6 \\
        #7 & #8 & #9 \\
    \end{vmatrix}
}

\newcommand{\VVtwo}[2]{%
    \begin{vmatrix}
        \texor@exists@phantom{#1} \\ #2 \\
    \end{vmatrix}
}

\newcommand{\HVtwo}[2]{%
    \begin{vmatrix}
        \texor@exists@phantom{#1} & 
        \texor@exists@phantom{#2}
    \end{vmatrix}
}
\newcommand{\VVthree}[3]{%
    \begin{vmatrix}
        \texor@exists@phantom{#1} \\ #2 \\ #3 \\
    \end{vmatrix}
}

\newcommand{\HVthree}[3]{%
    \begin{vmatrix}
        \texor@exists@phantom{#1} & 
        \texor@exists@phantom{#2} & 
        \texor@exists@phantom{#3}
    \end{vmatrix}
}

\newcommand{\Vdtwo}[2]{\Vtwo{#1}{}{}{#2}}
\newcommand{\Vdthree}[3]{\Vthree{#1}{}{}{}{#2}{}{}{}{#3}}

%%% Linguistics %%%

%% IPA %%
\newcommand{\tp}{\textipa}

\newcommand{\snd}[1]{\textipa{[#1]}}
\newcommand{\phn}[1]{\textipa{/#1/}}
\newcommand{\grh}[1]{$\langle$#1$\rangle$}
\newcommand{\tpgrh}[1]{\grh{\textipa{#1}}}

\newcommand{\gn}{\textltailn}

\newcommand{\@has}[4][-]{\texor@exists{#1}{{\texor@exists{#2}{[#3#2]}{#4}}}{\hasbrack{#2}}}
\newcommand{\withc}[2][-]{\@has[#1]{#2}{$+$}{[ ]}}
\newcommand{\sansc}[2][-]{\@has[#1]{#2}{$-$}{$\eset$}}
\newcommand{\phrule}[4]{{#1 $\to$ #2\texor@exists{#3#4}{ / \texor@exists{#3}{#3 }{}\_\texor@exists{#4}{ #4}{}}{}}}
\newcommand{\hasbrack}[1]{%
\begingroup%
\renewcommand{\withc}[2][-]{$+$##2}%
\renewcommand{\sansc}[2][-]{$-$##2}%
\renewcommand{\actv}[1]{$\al$ ##1}%
[#1]%
\endgroup%
}

\newcommand{\has}{\@ifstar\sansc\withc}
\newcommand{\actv}[1]{[$\al$ #1]}

%% Phonology %%
\newcommand{\plus}{$+$}
\newcommand{\minus}{$-$}
\newcommand{\into}{$\to$ }
\newcommand{\blank}{$\underline{\quad}$ }
\newcommand{\zero}{$\varnothing$ }

\endinput
%%
%% End of file `xor.sty'.
