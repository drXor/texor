% (c) 2015 Miguel Young
%
%% This program can be redistributed and/or modified under the terms
%% of the LaTeX Project Public License Distributed from CTAN archives
%% in directory macros/latex/base/lppl.txt.
% 
\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{texor}
  [2015/01/01 v1.0 teXor LaTeX Suite]

\let\h@rpoon\rightharpoonup

%% Style Note %%
% All internal commands should
% be of the form \texor@section@name
% where `Section` is the part of the 
% package it's declared in, and `name`
% is the actual command name.
%% %% %%%% %% %%

%%% IMPORTS %%%
\RequirePackage{amsthm}
\RequirePackage{verbatim}
\RequirePackage{bm}
\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{amsfonts}
\RequirePackage{scalerel}
\RequirePackage{ifthen}
\RequirePackage{xstring}
\RequirePackage{graphicx}
\RequirePackage{mathalfa}
\RequirePackage{accsupp}
\RequirePackage{verbatim}
\RequirePackage{xcolor}
\RequirePackage{esint}
\RequirePackage{mathtools}
\RequirePackage{xparse}
\RequirePackage{mathrsfs}
\RequirePackage{accents}
\RequirePackage{tikz}
\RequirePackage{tikz-cd}
\RequirePackage{enumitem}
\RequirePackage{siunitx}
\RequirePackage{cancel}
\RequirePackage{qtree}
%%% IMPORTS %%%

%%% FONT STUFF %%%
\def\amsbb{\use@mathgroup \M@U \symAMSb}

\RequirePackage[no-math]{fontspec}
\RequirePackage{xunicode}
\newfontfamily\xitsbb{XITS Math}

%% TIPA nonsense
% so, tipa redefines a bunch of macros, because they don't
% understand groups. thanks. luckily, tipa provides a reset command!

\undef\sups
\RequirePackage{tipa}

% save the magic commands
\let\texor@tipa@colon\:
\let\texor@tipa@semi\;
\let\texor@tipa@bang\!
\let\texor@tipa@star\*
\let\texor@tipa@pipe\|
\let\texor@tipa@syl\s

% reset them to LaTeX settings
\tipasafemode

% now we re-add them!

\newcommand{\texor@tipa@pre}{%
\let\:\texor@tipa@colon%
\let\;\texor@tipa@semi%
\let\!\texor@tipa@bang%
\let\*\texor@tipa@star%
\let\|\texor@tipa@pipe%
\def\~##1{$\tilde{\text{\textipa{\@stripdot{##1}}}}$}%
\def\^##1{$\hat{\text{\textipa{\@stripdot{##1}}}}$}%
\def\v##1{$\check{\text{\textipa{\@stripdot{##1}}}}$}%
\def\`##1{$\grave{\text{\textipa{\@stripdot{##1}}}}$}%
\def\'##1{$\acute{\text{\textipa{\@stripdot{##1}}}}$}%
\def\s##1{$\underset{\text{\textipa{"}}}{\text{\textipa{\texor@tipa@stripdot{##1}}}}$}%
}

\newcommand{\texor@tipa@stripdot}[1]{\ifx#1i\i\else\ifx#1j\j\else#1\fi\fi}

\newcommand{\texor@tipa@internal}[2][r]{%
\begingroup
\fontfamily{cm#1}%
\texor@tipa@pre%
\tipaencoding{#2}%
\endgroup}

% redefine the TIPA commands
\AtBeginDocument{
    \renewcommand\textipa[2][r]{{\texor@tipa@internal[#1]{#2}}}
}
\renewenvironment{IPA}[1][r]{%
\fontfamily{cm#1}%
\texor@tipa@pre%
\tipaencoding}{}
%% End TIPA

% everything beyond this point *must*
% come after tipa, because tipa does
% font voodoo

\RequirePackage{bbold}
\let\bbold\mathbb

\let\amscal\mathcal
\DeclareMathAlphabet{\othercal}{OT1}{pzc}{m}{it}

\usepackage{bm}
\def\mathbf#1{\bm{\mathrm{#1}}}

%%% END FONT STUFF %%%

%% this is for fun. really.
\newcommand{\TeXoR}
    {\TeX \hspace{-0.875ex}{\raisebox{0.31ex}{o}}\hspace{-0.55ex}R}

%% the \texor@exists{test}{then}{else} macro
% takes a string, and if it is nontrivial, outputs 
% `then`. otherwise, it outputs `else`.
\def\texor@exists@dummy{}
\newcommand{\texor@exists}[3]{\ifx\texor@exists@dummy#1\texor@exists@dummy #3\else #2\fi}

%%% Preamble %%%
\newcommand{\texor@call}[1]{\csname#1\endcsname}

% I have no idea what this does
\def\changemargin#1#2{\list{}{\rightmargin#2\leftmargin#1}\item[]}
\let\endchangemargin=\endlist

% or this... I think it stands for overset?
\newcommand{\oset}[3][0ex]{%
  {\mathop{#3}\limits^{
    \vbox to#1{\kern-2\ex@
    \hbox{$#2$}\vss}}}}

%% this is for the SI package.
% little sigma is more important.
\let\esi\si
\let\si\relax

%%% Theorems %%%

\let\defaultqed\qedsymbol

% generates theorem environments
\newcommand{\texor@thm@gen}[2]{%
    \newtheorem{S#1}{#2}[section]
    \newtheorem{#1}{#2}
    \newtheorem*{#1*}{#2}
}

% the /contradiction/ environment!
\def\deqsymbol{$\smashtimes$}
\newenvironment{proof*}[1][Proof]
    {\begin{proof}[#1]\def\qedsymbol{\deqsymbol}}
    {\end{proof}\def\deqsymbol{$\smashtimes$}}

% generates proof environments
\newcommand{\texor@thm@genproof}[3][]{%
    \newenvironment{#2}
        {\begin{proof}[#3] \texor@exists{#1}{\def\qedsymbol{#1}}{}}
        {\end{proof}}
}

% generates contradiction environments
\newcommand{\texor@thm@gencontr}[3][]{%
    \newenvironment{#2}
        {\begin{proof*}[#3] \texor@exists{#1}{\def\deqsymbol{#1}}{}}
        {\end{proof*}}
}

\theoremstyle{normal}

\texor@thm@gen{thm}{Theorem}
\texor@thm@gen{lem}{Lemma}
\texor@thm@gen{prop}{Proposition}
\texor@thm@gen{cor}{Corollary}

\theoremstyle{definition}

\texor@thm@gen{defn}{Definition}
\texor@thm@gen{axi}{Axiom}
\texor@thm@gen{conj}{Conjecture}
\texor@thm@gen{example}{Example}
\texor@thm@gen{exercise}{Exercise}
\texor@thm@gen{prob}{Problem}
\texor@thm@gen{fact}{Fact}

\theoremstyle{remark}

\texor@thm@gen{rem}{Remark}
\texor@thm@gen{note}{Note}
\texor@thm@gen{notation}{Notation}
  
\texor@thm@genproof{solution}{Solution}

%% the casework environment is secretly a list!
\newlist{casework}{enumerate}{4}
\setlist[casework]{
    label*=\arabic*.,
    leftmargin=!,
    wide,
    labelwidth=!, labelindent=0pt
}
\setlist[casework,1]{
    label={\emph{Case} \arabic*.}
}

\newlist{probenum}{enumerate}{0}
\setlist[probenum]{
    label=(\alph*),
    leftmargin=!,
    wide,
    labelwidth=!, labelindent=0pt
}

\newcommand{\resetQED}{%
    \renewcommand{\qedsymbol}{$\qed@symbol$}
    \renewcommand{\deqsymbol}{$\smashtimes$}
}

\newenvironment{probenum*}{\begin{prob}\begin{enumprob}}{\end{enumprob}\end{prob}}

%%% Variables %%%

%% General font magic %%

% Switch for ascii -> unicode bb %
\def\texor@fonts@xitschar{\xitsbb\char}
\newcommand{\texor@fonts@toblackboard}[1]{%
\ifthenelse{\equal{#1}{a}}{\texor@fonts@xitschar"1D552}{%
\ifthenelse{\equal{#1}{b}}{\texor@fonts@xitschar"1D553}{%
\ifthenelse{\equal{#1}{c}}{\texor@fonts@xitschar"1D554}{%
\ifthenelse{\equal{#1}{d}}{\texor@fonts@xitschar"1D555}{%
\ifthenelse{\equal{#1}{e}}{\texor@fonts@xitschar"1D556}{%
\ifthenelse{\equal{#1}{f}}{\texor@fonts@xitschar"1D557}{%
\ifthenelse{\equal{#1}{g}}{\texor@fonts@xitschar"1D558}{%
\ifthenelse{\equal{#1}{h}}{\texor@fonts@xitschar"1D559}{%
\ifthenelse{\equal{#1}{i}}{\texor@fonts@xitschar"1D55A}{%
\ifthenelse{\equal{#1}{j}}{\texor@fonts@xitschar"1D55B}{%
\ifthenelse{\equal{#1}{k}}{\texor@fonts@xitschar"1D55C}{%
\ifthenelse{\equal{#1}{l}}{\texor@fonts@xitschar"1D55D}{%
\ifthenelse{\equal{#1}{m}}{\texor@fonts@xitschar"1D55E}{%
\ifthenelse{\equal{#1}{n}}{\texor@fonts@xitschar"1D55F}{%
\ifthenelse{\equal{#1}{o}}{\texor@fonts@xitschar"1D560}{%
\ifthenelse{\equal{#1}{p}}{\texor@fonts@xitschar"1D561}{%
\ifthenelse{\equal{#1}{q}}{\texor@fonts@xitschar"1D562}{%
\ifthenelse{\equal{#1}{r}}{\texor@fonts@xitschar"1D563}{%
\ifthenelse{\equal{#1}{s}}{\texor@fonts@xitschar"1D564}{%
\ifthenelse{\equal{#1}{t}}{\texor@fonts@xitschar"1D565}{%
\ifthenelse{\equal{#1}{u}}{\texor@fonts@xitschar"1D566}{%
\ifthenelse{\equal{#1}{v}}{\texor@fonts@xitschar"1D567}{%
\ifthenelse{\equal{#1}{w}}{\texor@fonts@xitschar"1D568}{%
\ifthenelse{\equal{#1}{x}}{\texor@fonts@xitschar"1D569}{%
\ifthenelse{\equal{#1}{y}}{\texor@fonts@xitschar"1D56A}{%
\ifthenelse{\equal{#1}{z}}{\texor@fonts@xitschar"1D56B}{%
%
\ifthenelse{\equal{#1}{0}}{\texor@fonts@xitschar"1D7D8}{%
%\ifthenelse{\equal{#1}{1}}{\texor@fonts@xitschar"1D7D9}{%
\ifthenelse{\equal{#1}{2}}{\texor@fonts@xitschar"1D7DA}{%
\ifthenelse{\equal{#1}{3}}{\texor@fonts@xitschar"1D7DB}{%
\ifthenelse{\equal{#1}{4}}{\texor@fonts@xitschar"1D7DC}{%
\ifthenelse{\equal{#1}{5}}{\texor@fonts@xitschar"1D7DD}{%
\ifthenelse{\equal{#1}{6}}{\texor@fonts@xitschar"1D7DE}{%
%\ifthenelse{\equal{#1}{7}}{\texor@fonts@xitschar"1D7DF}{%
\ifthenelse{\equal{#1}{8}}{\texor@fonts@xitschar"1D7E0}{%
\ifthenelse{\equal{#1}{9}}{\texor@fonts@xitschar"1D7E1}{%
%
\ifthenelse{\equal{#1}{\pi}}{\texor@fonts@xitschar"0213C}{%
\ifthenelse{\equal{#1}{\gamma}}{\texor@fonts@xitschar"0213D}{%
\ifthenelse{\equal{#1}{\Gamma}}{\texor@fonts@xitschar"0213E}{%
\ifthenelse{\equal{#1}{\Pi}}{\texor@fonts@xitschar"0213F}{%
$\bbold{#1}$%
}}}}%
}}}}}}}}}}%
}}}}}}}}}}}}}}}}}}}}}}}}%}%}%
}
% End Switch %

\newcommand{\otherbb}[1]{\text{\texor@fonts@toblackboard{#1}}}

% Magic for mathbb/mathcal %
\newcommand{\texor@fonts@ifcapital}[3]{{\ifthenelse{
    \equal{#1}{A} \OR \equal{#1}{B} \OR \equal{#1}{C} \OR \equal{#1}{D} \OR
    \equal{#1}{E} \OR \equal{#1}{F} \OR \equal{#1}{G} \OR \equal{#1}{H} \OR
    \equal{#1}{I} \OR \equal{#1}{J} \OR \equal{#1}{K} \OR \equal{#1}{L} \OR
    \equal{#1}{M} \OR \equal{#1}{N} \OR \equal{#1}{O} \OR \equal{#1}{P} \OR
    \equal{#1}{Q} \OR \equal{#1}{R} \OR \equal{#1}{S} \OR \equal{#1}{T} \OR
    \equal{#1}{U} \OR \equal{#1}{V} \OR \equal{#1}{W} \OR \equal{#1}{X} \OR
    \equal{#1}{Y} \OR \equal{#1}{Z}
}{\texor@call{#2}{#1}}{\texor@call{#3}{#1}}}}

\def\texor@fonts@bb@outer#1{\texor@fonts@bb@loop#1\relax}
\def\texor@fonts@bb@loop#1{\ifx\relax#1\else\texor@fonts@ifcapital{#1}{amsbb}{otherbb}\expandafter\texor@fonts@bb@loop\fi}
\def\mathbb#1{\expandafter\texor@fonts@bb@outer\expandafter{#1}}

\def\texor@fonts@cal@outer#1{\texor@fonts@cal@loop#1\relax}
\def\texor@fonts@cal@loop#1{\ifx\relax#1\else\texor@fonts@ifcapital{#1}{amscal}{othercal}\expandafter\texor@fonts@cal@loop\fi}
\def\mathcal#1{\expandafter\texor@fonts@cal@outer\expandafter{#1}}
% End Magic %

%% Variable formats %%
\newcommand{\ivect}{\bm}
\newcommand{\vect}[1]{{\mathbf{#1}}}
\newcommand{\ihatt}[1]{\hat{\bm{#1}}}
\newcommand{\hatt}[1]{\mathbf{\hat{#1}}}
\newcommand{\veca}[1]{\vec{\mathbf{#1}}}
\newcommand{\cat}{\mathcal}
\newcommand{\namedCat}{\mathbf}
\newcommand{\fld}{\mathbb}
\newcommand{\lie}{\mathfrak}
\newcommand{\rmn}{\mathrm}

%% I don't think this actually works
\newcommand{\usevec}{
    \renewcommand{\vect}{\vec}
    \renewcommand{\hatt}[1]{\hat{##1}}
    \def\vnabla{\vec{\nabla}}
   
}
\newcommand{\useveca}{
    \renewcommand{\vect}{\veca}
    \def\vnabla{\vec{\nabla}}
}
\newcommand{\usevect}{
    \renewcommand{\vect}{\mathbf} 
    \renewcommand{\hatt}[1]{\hat{\mathbf{##1}}}
    \def\vnabla{\nabla}
}

% \texor@fonts@letter{letter}{prefix}{command}
% produces a single letter for an alphabet
\def\texor@fonts@letter#1#2#3{%
    \expandafter\providecommand\csname#2#1\endcsname
        {\csname#3\endcsname{#1}}
}

% \texor@fonts@alphabet{prefix}{command}
% produces an entire alphabet
\def\texor@fonts@alphabet#1#2{
    \texor@fonts@letter{a}{#1}{#2} \texor@fonts@letter{n}{#1}{#2}
    \texor@fonts@letter{b}{#1}{#2} \texor@fonts@letter{o}{#1}{#2}
    \texor@fonts@letter{c}{#1}{#2} \texor@fonts@letter{p}{#1}{#2}
    \texor@fonts@letter{d}{#1}{#2} \texor@fonts@letter{q}{#1}{#2}
    \texor@fonts@letter{e}{#1}{#2} \texor@fonts@letter{r}{#1}{#2}
    \texor@fonts@letter{f}{#1}{#2} \texor@fonts@letter{s}{#1}{#2}
    \texor@fonts@letter{g}{#1}{#2} \texor@fonts@letter{t}{#1}{#2}
    \texor@fonts@letter{h}{#1}{#2} \texor@fonts@letter{u}{#1}{#2}
    \texor@fonts@letter{i}{#1}{#2} \texor@fonts@letter{v}{#1}{#2}
    \texor@fonts@letter{j}{#1}{#2} \texor@fonts@letter{w}{#1}{#2}
    \texor@fonts@letter{k}{#1}{#2} \texor@fonts@letter{x}{#1}{#2}
    \texor@fonts@letter{l}{#1}{#2} \texor@fonts@letter{y}{#1}{#2}
    \texor@fonts@letter{m}{#1}{#2} \texor@fonts@letter{z}{#1}{#2}
    
    \texor@fonts@letter{A}{#1}{#2} \texor@fonts@letter{N}{#1}{#2}
    \texor@fonts@letter{B}{#1}{#2} \texor@fonts@letter{O}{#1}{#2}
    \texor@fonts@letter{C}{#1}{#2} \texor@fonts@letter{P}{#1}{#2}
    \texor@fonts@letter{D}{#1}{#2} \texor@fonts@letter{Q}{#1}{#2}
    \texor@fonts@letter{E}{#1}{#2} \texor@fonts@letter{R}{#1}{#2}
    \texor@fonts@letter{F}{#1}{#2} \texor@fonts@letter{S}{#1}{#2}
    \texor@fonts@letter{G}{#1}{#2} \texor@fonts@letter{T}{#1}{#2}
    \texor@fonts@letter{H}{#1}{#2} \texor@fonts@letter{U}{#1}{#2}
    \texor@fonts@letter{I}{#1}{#2} \texor@fonts@letter{V}{#1}{#2}
    \texor@fonts@letter{J}{#1}{#2} \texor@fonts@letter{W}{#1}{#2}
    \texor@fonts@letter{K}{#1}{#2} \texor@fonts@letter{X}{#1}{#2}
    \texor@fonts@letter{L}{#1}{#2} \texor@fonts@letter{Y}{#1}{#2}
    \texor@fonts@letter{M}{#1}{#2} \texor@fonts@letter{Z}{#1}{#2}
}

%% Shorthands %%
\newcommand{\vl}{\vect{\ell}}
\newcommand{\vii}{\bm{\textnormal{\bfseries\i}}}
\newcommand{\vjj}{\bm{\textnormal{\bfseries\j}}}
\newcommand{\hi}{\hat{\ii}}
\newcommand{\hj}{\hat{\jj}}
\newcommand{\Hi}{\hat{\vii}}
\newcommand{\Hj}{\hat{\vjj}}
\newcommand{\fii}{\fld{i}}

\newcommand{\vzero}{\vect{0}}
\newcommand{\vone}{\vect{1}}
\newcommand{\vtwo}{\vect{2}}
\newcommand{\vthree}{\vect{3}}
\newcommand{\vfour}{\vect{4}}
\newcommand{\vfive}{\vect{5}}

\texor@fonts@alphabet{v}{vect}   % vectors
\texor@fonts@alphabet{h}{hat}    % vectors with hats!
\texor@fonts@alphabet{H}{hatt}   % bold vectors with hats!
\texor@fonts@alphabet{iv}{ivect} % italic vectors
\texor@fonts@alphabet{iH}{ihatt} % italic vectors with hats!
\texor@fonts@alphabet{L}{lie}    % fracktur (lie)
\texor@fonts@alphabet{C}{cat}    % calligraphy
\texor@fonts@alphabet{f}{fld}    % black board
 
% Greek %
\newcommand{\al}{\alpha}
\newcommand{\be}{\beta}
\newcommand{\ga}{\gamma}
\newcommand{\de}{\delta}
\newcommand{\la}{\lambda}
\newcommand{\te}{\theta}
\newcommand{\ka}{\kappa}
\newcommand{\si}{\sigma}
\newcommand{\om}{\omega}
\newcommand{\ze}{\zeta}
\newcommand{\ep}{\varepsilon}
\newcommand{\ph}{\varphi}
\newcommand{\ps}{\psi}
\newcommand{\ups}{\upsilon}

\newcommand{\vte}{\vartheta}
\newcommand{\vka}{\varkappa}
\newcommand{\vsi}{\varsigma}
\newcommand{\vep}{\epsilon}
\newcommand{\vps}{\varpsi}
\newcommand{\vrho}{\varrho}
\newcommand{\vpi}{\varpi}

\newcommand{\Ga}{\Gamma}
\newcommand{\De}{{\mathchoice
    {\hstretch{0.8}{\Delta}}
    {\hstretch{0.8}{\Delta}}
    {\hstretch{0.7}{\Delta}}
    {\hstretch{0.7}{\Delta}}}}
\newcommand{\Te}{\Theta}
\newcommand{\lla}{\Lambda}
\newcommand{\LLa}{\Lambda}
\newcommand{\Si}{\Sigma}
\newcommand{\Om}{\Omega}
\newcommand{\Ph}{\Phi}
\newcommand{\Ps}{\Psi}
\newcommand{\Ups}{\Upsilon}

\newcommand{\vGa}{\varGamma}
\newcommand{\vDe}{{\mathchoice
    {\hstretch{0.8}{\varDelta}}
    {\hstretch{0.8}{\varDelta}}
    {\hstretch{0.7}{\varDelta}}
    {\hstretch{0.7}{\varDelta}}}}
\newcommand{\vLa}{\varLambda}
\newcommand{\vTe}{\varTheta}
\newcommand{\vSi}{\varSigma}
\newcommand{\vOm}{\varOmega}
\newcommand{\vPs}{\varPsi}
\newcommand{\vXi}{\varXi}
\newcommand{\vPh}{\varPhi}
\newcommand{\vPi}{\varPi}

\let\bignabla\nabla
\def\nabla{{\mathchoice
    {\hstretch{0.8}{\bignabla}}
    {\hstretch{0.8}{\bignabla}}
    {\hstretch{0.7}{\bignabla}}
    {\hstretch{0.7}{\bignabla}}}}
\def\vnabla{\nabla}

% Misc %
\newcommand{\eset}{\varnothing}

\newcommand{\ii}{\imath}
\newcommand{\jj}{\jmath}

%% Common Variables %%

\let\pilcrow\P

% Number Systems %
\newcommand{\F}{\fF}   % finite field
\newcommand{\N}{\fN}   % natural numbers
\newcommand{\Z}{\fZ}   % integers
\newcommand{\Q}{\fQ}   % rational numbers
\newcommand{\R}{\fR}   % real numbers
\newcommand{\C}{\fC}   % complex numbers
\renewcommand{\P}{\fP} % PROJECTIVE SPACE!!!
\newcommand{\RP}{\R\P}

\newcommand{\newlineargroup}[2]{
    \DeclareDocumentCommand{#1}{ O{} O{} }{\mathrm{#2}_{##1}\texor@exists{##2}{\Par{##2}}{}}
}

\newlineargroup{\GL}{GL}
\newlineargroup{\SL}{SL}
\newlineargroup{\SO}{SO}
\newlineargroup{\sO}{O}
\newlineargroup{\SU}{SU}
\newlineargroup{\sU}{U}
\newlineargroup{\Mat}{M}

\newlineargroup{\lGL}{\lie{gl}}
\newlineargroup{\lSL}{\lie{sl}}
\newlineargroup{\lSO}{\lie{so}}
\newlineargroup{\lsO}{\lie{o}}
\newlineargroup{\lSU}{\lie{su}}
\newlineargroup{\lsU}{\lie{u}}
\newlineargroup{\lMat}{\lie{m}}

% Categories %

\newcommand{\newcategory}[2][c]{
    \expandafter\newcommand\csname #1#2\endcsname{
        {\namedCat{#2}}
    }
}
\newcommand{\newleftcategory}[2][cl]{
    \expandafter\newcommand\csname #1#2\endcsname[1][]{
        {\texor@exists{##1}{##1\text{-}}{}\namedCat{#2}}
    }
}
\newcommand{\newrightcategory}[2][cr]{
    \expandafter\newcommand\csname #1#2\endcsname[1][]{
        {\namedCat{#2}\texor@exists{##1}{\text{-}##1}{}}
    }
}
\newcommand{\newleftrightcategory}[2][clr]{
    \expandafter\DeclareDocumentCommand\csname #1#2\endcsname{ O{} O{} }{
        {\texor@exists{##1}{##1\text{-}}{}\namedCat{#2}\texor@exists{##2}{\text{-}##2}{}}
    }
}
\newcommand{\newsubcriptcategory}[2][cv]{
    \expandafter\newcommand\csname #1#2\endcsname[1][]{
        {\namedCat{#2}_{##1}}
    }
}
\newcommand{\newleftsubcriptcategory}[2][cvl]{
    \expandafter\DeclareDocumentCommand\csname #1#2\endcsname{ O{} O{} }{
        {\texor@exists{##1}{##1\text{-}}{}\namedCat{#2}_{##2}}
    }
}
\newcommand{\newparentesiscategory}[2][cp]{
    \expandafter\newcommand\csname #1#2\endcsname[1][]{
        {\namedCat{#2}\Par{##1}}
    }
}

% Cats: Sets
\newcategory{Set}        % sets / functions
\newcategory{Cls}        % classes / functions
\newcategory{Ens}        % ensambles / functions
\newcategory{Fin}        % finite sets / functions
\newcategory{Finord}     % finite ordinals / order-preserving functions
\newcategory{Ord}        % ordered sets / order-preserving maps
\newcategory{Rel}        % relations / relation-preserving maps

% Cats: Grps %
\newcategory{Mon}        % monoids / homomorphisms
\newcategory{Grp}        % groups / homomorphisms
\newcategory{Ab}         % abelian groups / homomorphisms
\newcategory{Rig}        % rigs / homomorphisms
\newcategory{Rng}        % rngs / homomorphisms
\newcategory{Ring}       % rings / homomorphisms
\newcategory{CRng}       % commutative rngs / homomorphisms
\newcategory{CRing}      % commutative rings / homomorphisms
\newcategory{Dom}        % integral domains / homomorphisms
\newcategory{Fld}        % fields / homomorphisms

\newleftrightcategory[c]{Mod}      % two-sided modules / linear maps
\newrightcategory{Mod}             % right modules / linear maps
\newsubcriptcategory[c]{Chn}       % chains over a ring
\newleftrightcategory[c]{GMod}     % graded modules / linear maps
\newleftrightcategory[c]{DGMod}    % differential graded modules
\newsubcriptcategory[c]{Alg}       % algebras / homomorphisms
\newsubcriptcategory[c]{CAlg}      % commutative algebras / homomorphisms
\newsubcriptcategory[c]{Rep}       % representations / intertwiners
\newleftsubcriptcategory[cv]{Rep}  % " / " (w/ subscript)
\newsubcriptcategory[c]{Vct}       % vector spaces / linear maps
\newsubcriptcategory[c]{Vect}      % " / "

% Cats: Calc %
\newcategory{Met}        % metric spaces / metric-preserving maps
\newcategory{CMet}       % complete metric spaces / metric-preserving functions
\newcategory{Hil}        % Hilbert spaces
\newcategory{Ban}        % Banach spaces
\newcategory{Lie}        % Lie groups/algebras
\newcategory{Man}        % manifolds
\newcategory{DMan}       % differentiable manifolds
\newcategory{SMan}       % smooth manifolds

% Cats: Cats %
\newcategory{Grph}          % graphs / morphisms of graphs
\newcategory{Quiv}          % quivers / morphisms of quivers
\newleftcategory[c]{Cat}    % categories / functors
\newcategory{AbCat}         % Ab categories / additive functors
\newcategory{CAT}           % large categories / functors
\newleftcategory[c]{Gpd}    % groupoids / homomorphisms
\newcategory{Moncat}        % monoidal categories / monoidal functors
\newcategory{MCat}          % model categories / Quillen adjunctions
\newcategory{sSet}          % simplicial sets / functions
\newcategory{sCat}          % simplicial categories

\newcommand{\cCatad}{\cCat_{\rmn{ad}}} % adjunctions

\newcategory{Map}        % maps of various kinds
\newcategory{Mor}        % "
\newcategory{Funct}      % "
\newcategory{Func}       % "
\newcategory{Fun}        % "
\newcategory{End}        % endofunctors / natural transformations
\newcategory{Nat}        % natural transformations
\newcategory{Cone}       % cones

% Cats: Tops $
\newcategory{Top}        % topological spaces / continuous maps
\newcategory{Toph}       % topological spaces / maps modulo homotopy
\newcategory{Htpy}       % " / "
\newcategory{hTop}       % " / "
\newcategory{Haus}       % Hausdorff spaces
\newcategory{CHaus}      % compact Hausdorff spaces
\newcategory{CGHaus}     % compactly generated Hausdorff

\newparentesiscategory[cp]{Open}  % open subsets / inclusions

% Cats: Misc %
\newsubcriptcategory[c]{Matr}   % natural numbers / matrices
\newcommand{\cDel}{\hstretch{0.8}{\varDelta}} % deprecated

\newcommand{\cDe}{\hstretch{0.8}{\varDelta}} % simplex category
\newcommand{\CDe}[1][]{\texor@exists{#1}{\mathbf{\cDe}_{\leq #1}}{\mathbf{\cDe}}} % simplex category
\newcommand{\CDeop}[1][]{\opp{\CDe[#1]}} % simplex category


%%% Delimiters %%%

\newcommand{\texor@delim@base}[5]{{
    \scalerel[2ex]{#3}{\vphantom{\left#1#4\right.}}
    #4
    \scalerel[2ex]{#5}{\vphantom{\left#2#4\right.}}
}}

\DeclareDocumentCommand{\texor@delim@new}{ O{} O{} m m m }{%
    \expandafter\newcommand\csname #3\endcsname[1]{%
        {\left#4#1##1#2\right#5}
    }
}
% \newDelim[linner][rinner][lmodel][rmodel]{name}{ldelim}{rdelim}
\DeclareDocumentCommand{\texor@delim@New}{ O{} O{} O{(} O{)} m m m }{%
    \expandafter\newcommand\csname #5\endcsname[1]{%
        \texor@delim@base{#3}{#4}{#6}{#1##1#2}{#7}
    }
}

\newcommand{\spacechoice}[4]{
    \mathchoice{\hspace{#1}}{\hspace{#2}}{\hspace{#3}}{\hspace{#4}}}

% ()
\providecommand{\lparens}{(}
\providecommand{\rparens}{)}
\providecommand{\llparens}
    {\mathchoice{\bigg(}{\big(}{(}{(}
        \spacechoice{-2.5pt}{-2.1pt}{-1.7pt}{-1.7pt}
            \mathchoice{\hstretch{1.3}{\bigg|}}{\big|}{|}{|}\hspace{-0.7pt}}
\providecommand{\rrparens}
    {\mathchoice{\hstretch{1.3}{\bigg|}}{\big|}{|}{|}
        \spacechoice{-2.5pt}{-2.1pt}{-1.7pt}{-1.7pt}
            \mathchoice{\bigg)}{\big)}{)}{)}}

\texor@delim@new{Par}{\lparens}{\rparens}
\texor@delim@New{Paar}{\llparens}{\rrparens}

% []
\providecommand{\lbrack}{[}
\providecommand{\rbrack}{]}
\providecommand{\llbrack}
    {\mathchoice{\bigg[}{\big[}{[}{[}\spacechoice{-4pt}{-3.1pt}{-1.3pt}{-1.2pt}
        \mathchoice{\bigg[}{\big[}{[}{[}\hspace{-0.4pt}}
\providecommand{\rrbrack}
    {\hspace{-0.4pt}\mathchoice{\bigg]}{\big]}{]}{]}
        \spacechoice{-4pt}{-3.1pt}{-1.3pt}{-1.2pt}\mathchoice{\bigg]}{\big]}{]}{]}}

\texor@delim@new{Squ}{\lbrack}{\rbrack}
\texor@delim@New{Sqqu}{\llbrack}{\rrbrack}

% [) (]
\texor@delim@new[][\spacechoice{1pt}{1pt}{0.8pt}{0.5pt}]{PSqu}{\lparens}{\rbrack}
\texor@delim@new[\spacechoice{1pt}{1pt}{0.8pt}{0.5pt}][]{SPar}{\lbrack}{\rparens}
\texor@delim@New{PSqqu}{\llparens}{\rrbrack}
\texor@delim@New{SPaar}{\llbrack}{\rrparens}

% {}
\providecommand{\lbrace}{\{}
\providecommand{\rbrace}{\}}
\providecommand{\llbrace}
    {\mathchoice{\{}{\{}{\{}{\{}\spacechoice{-3.0pt}{-3.2pt}{-2.5pt}{-2.5pt}
        \mathchoice{\hstretch{1.5}{|}}{\hstretch{1.5}{|}}
            {\hstretch{1.5}{|}}{\hstretch{1.5}{|}}\hspace{-0.7pt}}
\providecommand{\rrbrace}
    {\hspace{-0.7pt}\mathchoice{\hstretch{1.5}{|}}{\hstretch{1.5}{|}}
            {\hstretch{1.5}{|}}{\hstretch{1.5}{|}}\spacechoice{-3.2pt}{-3.2pt}{-2.5pt}
                {-2.5pt}\mathchoice{\}}{\}}{\}}{\}}}

\texor@delim@new[\spacechoice{1pt}{0pt}{0pt}{-0.5pt}]
    [\spacechoice{1pt}{0pt}{0pt}{-0.5pt}]{Cur}{\lbrace}{\rbrace}
\texor@delim@New{Cuur}{\llbrace}{\rrbrace}
    
% ||
\texor@delim@new{Abs}{|}{|}
\texor@delim@New{Abbs}{\Vert}{\Vert}
\def\Nor{\Abbs}

% Ceiling and Floor
\texor@delim@new[\spacechoice{2.2pt}{0pt}{0pt}{-1pt}][\spacechoice{2.2pt}{0pt}{0pt}{-1pt}]
    {Ceil}{\lceil}{\rceil}
\texor@delim@New[\spacechoice{2.2pt}{0pt}{0pt}{-1pt}][\spacechoice{2.2pt}{0pt}{0pt}{-1pt}]
    {Flo}{\lfloor}{\rfloor}

% <>
% TODO: fix
%\newDelim{Ang}
%    {\mathchoice{\bigg\langle}{\langle}{\langle}{\langle}}
%    {\mathchoice{\bigg\rangle}{\rangle}{\rangle}{\rangle}}
\texor@delim@new{Ang}{\langle}{\rangle}
\texor@delim@New{Anng}
    {\mathchoice{\bigg\langle}{\langle}{\langle}{\langle}
        \spacechoice{-3.95pt}{-2.3pt}{-1.8pt}{-1.8pt}
            \mathchoice{\hstretch{1.5}{\bigg|}}{|}{|}{|}}
    {\mathchoice{\hstretch{1.5}{\bigg|}}{|}{|}{|}
        \spacechoice{-3.95pt}{-2.3pt}{-1.8pt}{-1.8pt}
            \mathchoice{\bigg\rangle}{\rangle}{\rangle}{\rangle}}

% f|
\texor@delim@new{restr}{.}{|}

% f/g
\newcommand{\Quot}[2]{\left.#1\middle/#2\right.}

% <|
\texor@delim@new{Bra}{\langle}{|}

\texor@delim@New[][\spacechoice{1.6pt}{0.8pt}{0.8pt}{-0.5pt}]
    {@Bra}
    {\mathchoice{\bigg\langle}{\langle}{\langle}{\langle}}
    {\mathchoice{\bigg|}{|}{|}{|}}

% |>
\texor@delim@new{Ket}{|}{\rangle}
\newcommand{\Keet}[2]{\Ket{#1\,;#2}}

\texor@delim@New[\spacechoice{1.6pt}{0.8pt}{0.8pt}{-0.5pt}][]%
    {@Ket}%
    {\mathchoice{\bigg|}{|}{|}{|}}%
    {\mathchoice{\bigg\rangle}{\rangle}{\rangle}{\rangle}}

% Comprehension {|}
\newcommand{\mkset}[2]{\left.\Cur{#1\spacechoice{2.2pt}{1pt}{0.8pt}{-0.5pt}\middle|\spacechoice{2.2pt}{1pt}{0.8pt}{-0.5pt}#2}\right.}

% Bra-Ket <|> <||>
\newcommand{\BraKet}[2]{\left.\Ang{#1\spacechoice{2.2pt}{1pt}{0.8pt}{-0.5pt}\middle|\spacechoice{2.2pt}{1pt}{0.8pt}{-0.5pt}#2}\right.}

\newcommand{\BrraKeet}[3]{\left.\Ang{#1\spacechoice{2.2pt}{1pt}{0.8pt}{-0.5pt}\middle|\spacechoice{2.2pt}{1pt}{0.8pt}{-0.5pt}#2\spacechoice{2.2pt}{1pt}{0.8pt}{-0.5pt}\middle|\spacechoice{2.2pt}{1pt}{0.8pt}{-0.5pt}#3}\right.}

%%% Operators %%%

\newcommand{\dispfrac}[2]{\frac{\displaystyle{#1}}{\displaystyle{#2}}}

% Big operators macros %

\newcommand{\newbigop}[2]{%
    \expandafter\DeclareRobustCommand\csname#1\endcsname{%
        \mathop{\vphantom{\sum}\expandafter\mathpalette\csname#1@bigop\endcsname\relax}\slimits@
    }

    \expandafter\newcommand\csname#1@bigop\endcsname[2]{%
        \vcenter{%
            \sbox\z@{$##1\sum$}%
            \hbox{\resizebox{.9\dimexpr\ht\z@+\dp\z@}{!}{$\ThisStyle{##1}\m@th#2$}}%
        }%
    }
}

\let\texor@sym@bigstar\bigstar
\def\fatstar{\mathbin{\scalerel*{\texor@sym@bigstar}{\ThisStyle{}\times}}}
\newbigop{bigstar}{\star}
\newbigop{bigast}{\ast}
\newbigop{bigfatstar}{\fatstar}

\newcommand{\texor@sym@smash@display}{%
\begin{tikzpicture}[rotate=45,x=0.5ex,y=0.5ex]
\draw[line width=.095ex, line cap=round] (0,2) -- (3,2) (0,1) -- (3,1) (1,3) -- (1,0) (2,3) -- (2,0);
\end{tikzpicture}
}
\newcommand{\texor@sym@smash@other}{%
\begin{tikzpicture}[rotate=45,x=0.5ex,y=0.5ex]
\draw[line width=.12ex, line cap=round] (0,2) -- (3,2) (0,1) -- (3,1) (1,3) -- (1,0) (2,3) -- (2,0);
\end{tikzpicture}
}

\newcommand{\texor@sym@conn@display}{%
\begin{tikzpicture}[x=0.7ex,y=0.7ex]
\draw[line width=.095ex, line cap=round] (0.5,2) -- (2.5,2) (0.5,1) -- (2.5,1) (1,3) -- (1,0) (2,3) -- (2,0);
\end{tikzpicture}
}

\newcommand{\texor@sym@conn@other}{%
\begin{tikzpicture}[x=0.5ex,y=0.5ex]
\draw[line width=.11ex, line cap=round] (0.5,2) -- (2.5,2) (0.5,1) -- (2.5,1) (1,3) -- (1,0) (2,3) -- (2,0);
\end{tikzpicture}
}

\newcommand{\smashtimes}{\mathbin{\texor@sym@smash@other}}

\newcommand{\connplus}{\mathbin{\texor@sym@conn@other}}

\newbigop{bigsmash}{\mathchoice{\texor@sym@smash@display}{\texor@sym@smash@other}{\texor@sym@smash@other}{\texor@sym@smash@other}}

\newbigop{bigconn}{\mathchoice{\texor@sym@conn@display}{\texor@sym@conn@other}{\texor@sym@conn@other}{\texor@sym@conn@other}}

\newcommand{\hash}{\mathbin{\#}}
\newbigop{bighash}{\#}

\newcommand{\at}{\mathbin{\text{@}}}
\newbigop{bigat}{\text{@}}

\newbigop{bigdiv}{\div}

\newcommand{\texor@sym@plus@display}{%
\begin{tikzpicture}%[rotate=45,x=0.5ex,y=0.5ex]
\draw[line width=.4ex, line cap=round] (0,0) -- (1,0) (0.5,-0.5) -- (0.5,0.5);
\end{tikzpicture}
}
\newcommand{\texor@sym@plus@other}{%
\begin{tikzpicture}%[rotate=45,x=0.5ex,y=0.5ex]
\draw[line width=0.6ex, line cap=round] (0,0) -- (1,0) (0.5,-0.5) -- (0.5,0.5);
\end{tikzpicture}
}

\newcommand{\texor@sym@times@display}{%
\begin{tikzpicture}[rotate=45,x=0.5ex,y=0.5ex]
\draw[line width=.065ex, line cap=round] (0,1.5) -- (3,1.5) (1.5,3) -- (1.5,0);
\end{tikzpicture}
}
\newcommand{\texor@sym@times@other}{%
\begin{tikzpicture}[rotate=45,x=0.5ex,y=0.5ex]
\draw[line width=.12ex, line cap=round] (0,1.5) -- (3,1.5) (1.5,3) -- (1.5,0);
\end{tikzpicture}
}

\newbigop{bigplus}{\mathchoice{\texor@sym@plus@display}{\texor@sym@plus@other}{\texor@sym@plus@other}{\texor@sym@plus@other}}

%% Operators %%

%% witchcraft for extracting operator names %%
\begingroup\lccode`\|=`\\
\lowercase{\endgroup\def\removebs#1{\if#1|\else#1\fi}}
\newcommand{\texor@macro@name}[1]{\expandafter\removebs\string#1}

\newcommand{\texor@oper@internal@new}[2]{
    \expandafter\newcommand\csname texor@oper@internal@\texor@macro@name{#1}\endcsname{#2}
}

\newcommand{\texor@oper@internal@renew}[2]{
    \expandafter\renewcommand\csname texor@oper@internal@\texor@macro@name{#1}\endcsname{#2}
}

\newcommand{\texor@oper@internal}[1]{
    \csname texor@oper@internal@\texor@macro@name{#1}\endcsname
}

\newcommand{\texor@oper@undefifnointernal}[1]{
    \texor@exists{\texor@oper@internal{#1}}{}{\undef#1}
}

\newcommand{\texor@oper@new@small}[2]{
    \providecommand{#1}{1}
    \texor@oper@internal@new{#1}{#2}
    \renewcommand{#1}[1][]{\texor@exists{##1}
        {\operatorname{\mathrm{\texor@oper@internal{#1}}}\!\Par{##1}}
        {\operatorname{\mathrm{\texor@oper@internal{#1}}}}
    }
}

\newcommand{\texor@oper@new@big}[2]{
    \providecommand{#1}{1}
    \texor@oper@internal@new{#1}{#2}
    \renewcommand{#1}[1][]{\texor@exists{##1}
        {\mathop{\mathrm{\texor@oper@internal{#1}}}\!\Par{##1}}
        {\mathop{\mathrm{\texor@oper@internal{#1}}}
    }}
}

\newcommand{\newmathop}{\@ifstar\texor@oper@new@big\texor@oper@new@small}

\newcommand{\texor@oper@new@sub}[3][*]{
    \providecommand{#2}{1}
    \texor@oper@internal@new{#2}{#3}
    \DeclareDocumentCommand{#2}{ O{#1} O{} }{
        \texor@exists{##2}
            {\operatorname{\mathrm{\texor@oper@internal{#2}}}_{##1}\!\Par{##2}}
            {\operatorname{\mathrm{\texor@oper@internal{#2}}}_{##1}} 
    }
}

\newcommand{\texor@oper@new@sup}[3][*]{
    \providecommand{#2}{1}
    \texor@oper@internal@new{#2}{#3}
    \DeclareDocumentCommand{#2}{ O{#1} O{} }{
        \texor@exists{##2}
            {\operatorname{\mathrm{\texor@oper@internal{#2}}}^{##1}\!\Par{##2}}
            {\operatorname{\mathrm{\texor@oper@internal{#2}}}^{##1}} 
    }
}

\newcommand{\newmathzop}{\@ifstar\texor@oper@new@sup\texor@oper@new@sub}

\newcommand{\newprefix}[2]{
    \providecommand{#1}{1}
    \texor@oper@internal@new{#1}{#2}
    \renewcommand{#1}[1][]{
        \texor@exists{##1}
            {\mathrm{\texor@oper@internal{#1}}\Par{##1}}
            {\mathrm{\texor@oper@internal{#1}}}
    }
}

\newcommand{\texor@oper@script@sub}[2]{
    \providecommand{#1}{1}
    \texor@oper@internal@new{#1}{#2}
    \renewcommand{#1}[1]{##1^{\mathrm{\texor@oper@internal{#1}}}}
}

\newcommand{\texor@oper@script@sup}[2]{
    \providecommand{#1}{1}
    \texor@oper@internal@new{#1}{#2}
    \renewcommand{#1}[1]{##1_{\mathrm{\texor@oper@internal{#1}}}}
}

\newcommand{\newscriptop}{\@ifstar\texor@oper@script@sup\texor@oper@script@sub}

\newcommand{\newsuffixop}[2]{
    \providecommand{#1}{1}
    \texor@oper@internal@new{#1}{#2}
    \renewcommand{#1}[1]{{##1\text{-}\mathrm{\texor@oper@internal{#1}}}}
}

%% Trig %%

\newmathop{\sin}{sin}
\newmathop{\cos}{cos}
\newmathop{\tan}{tan}
\newmathop{\csc}{csc}
\newmathop{\sec}{sec}
\newmathop{\cot}{cot}

\newmathzop*[]{\sinn}{sin}
\newmathzop*[]{\cosn}{cos}
\newmathzop*[]{\tann}{tan}
\newmathzop*[]{\cscn}{csc}
\newmathzop*[]{\secn}{sec}
\newmathzop*[]{\cotn}{cot}

\newmathop{\arcsin}{arcsin}
\newmathop{\arccos}{arccos}
\newmathop{\arctan}{arctan}
\newmathop{\arccsc}{arccsc}
\newmathop{\arcsec}{arcsec}
\newmathop{\arccot}{arccot}

\newmathop{\sinh}{sinh}
\newmathop{\cosh}{cosh}
\newmathop{\tanh}{tanh}
\newmathop{\csch}{csch}
\newmathop{\sech}{sech}
\newmathop{\coth}{coth}

\newmathzop*[]{\sinhn}{sinh}
\newmathzop*[]{\coshn}{cosh}
\newmathzop*[]{\tanhn}{tanh}
\newmathzop*[]{\cschn}{csch}
\newmathzop*[]{\sechn}{sech}
\newmathzop*[]{\cothn}{coth}

\newmathop{\arcsinh}{arcsinh}
\newmathop{\arccosh}{arccosh}
\newmathop{\arctanh}{arctanh}
\newmathop{\arccsch}{arccsch}
\newmathop{\arcsech}{arcsech}
\newmathop{\arccoth}{arccoth}

\newmathop{\ln}{ln}
\newmathop{\log}{log}
\newmathzop[]{\logn}{log}
\newmathop{\exp}{exp}
\newcommand{\euler}{\bm{e}}
\newcommand{\qI}{\cat{i}}
\newcommand{\qJ}{\cat{j}}
\newcommand{\qK}{\cat{k}}
\newcommand{\I}{\qI}%{{\dot{\iota}}}
\newcommand{\E}[1]{\euler^{#1}}
\newmathop{\lb}{lb}

\def\optimes{\mathop{\otimes}}

%% Algebra %%
\newmathop{\img}{im}
\newmathop{\rank}{rank}
\newmathop{\ker}{ker}
\newmathop{\nullsp}{null}
\newmathop{\dim}{dim}
\newmathop{\det}{det}
\newmathop{\coker}{coker}
\newcommand{\image}{\img} %% deprecated
\newmathop{\Span}{span}
\newmathop{\sign}{sign}
\newscriptop{\transp}{T}
\newscriptop{\abel}{ab}
\newscriptop{\cotran}{\dagger}
\newscriptop{\opp}{op}
\newscriptop{\dual}{*}
\newscriptop{\comp}{c}
\newmathop{\tr}{tr}
\newmathop{\Res}{\vphantom{d}Res}
\newmathop{\Ind}{Ind}
\newmathop{\Ann}{Ann}
\newmathop{\Frac}{Frac}
\newmathop{\Char}{char}
\newcommand{\Gal}[1][]{\rmn{Gal}\texor@exists{#1}{\Par{#1}}{}}
\newmathop{\Rad}{Rad}

\newcommand{\Tens}[1][]{{T^{#1}}}
\newcommand{\Symm}[1][]{{\mathrm{Sym}^{#1}}}
\newcommand{\Extr}[1][]{{\LLa^{#1}}}

\newcommand{\powset}[1]{\CP\left(#1\right)} 

\renewcommand{\mod}{\mathrel{\rmn{mod}}}

% I'll be honest, I hate default \Re and \Im
\newmathop{\Re}{\LR}
\newmathop{\Im}{\LI}

%% Number Theory %%
\newmathop{\gcd}{gcd}
\newmathop{\lcd}{lcd}

%% Categories %%
\newmathop{\texor@oper@Hom}{\cat{hom}} % hom-set
\newmathzop[]{\texor@oper@Homz}{\cat{hom}} % hom-set
\newcommand{\Hom}{\@ifstar\texor@oper@Homz\texor@oper@Hom}
\newmathop{\Endo}{End}      % endomorphism
\newmathop{\Aut}{Aut}       % automorphism
\newmathop{\Obj}{\cat{obj}} % category objects
\newmathop{\Mor}{\cat{mor}} % category morphisms
\newmathop{\Dom}{\cat{dom}} % domain
\newmathop{\Cod}{\cat{cod}} % codomain
\newmathop{\sk}{sk}         % skeleton
\newmathop{\cosk}{cosk}     % coskeleton
\newcommand*\prd{\times}    % product
\newcommand{\coprd}{\amalg} % coproduct
\newcommand{\cotimes}{\amalg}
\newmathop*{\Lim}{lim}      % lim
\newmathop*{\Colim}{colim}  % colim
\newcommand{\Id}{\cat{id}}  % category identity map
\newmathop{\Elmt}{Elmt}     % element category
\newprefix{\Nrv}{N}         % nerve
\newprefix{\hcat}{h}        % homotopy category
\newprefix{\hCat}{\vh}        % homotopy 2-category
\newmathop{\Map}{Map}
\newmathop{\Fib}{Fib}
\newmathop{\Cofib}{Cofib}
\newscriptop*{\fobj}{f}
\newscriptop*{\cobj}{c}
\newscriptop*{\cfobj}{cf}
\newmathop{\cCh}{\namedCat{Ch}}
\newmathop{\ev}{ev}

\newcommand{\rsim}{\mathbin{\overset{\rmn{R}}{\sim}}}
\newcommand{\lsim}{\mathbin{\overset{\rmn{L}}{\sim}}}

\newsuffixop{\sinj}{inj}
\newsuffixop{\sproj}{proj}
\newsuffixop{\scof}{cof}
\newsuffixop{\sfib}{fib}

\newsuffixop{\scell}{cell}
  
%% Topology %%
\newmathop{\Int}{Int} % interior
\newmathop{\Ext}{Ext} % exteriror
\newmathop{\Bd}{Bd}   % boundary
\newcommand{\qsim}{{/{\sim}}}
\newcommand{\op}[1]{#1^\circ}
\newcommand{\piN}[1]{\operatorname{\pi_{#1}}}
\newmathop{\Sing}{Sing}

\newmathzop{\hmS}{\mathnormal{S}}
\newmathzop{\hmZ}{\mathnormal{Z}}
\newmathzop{\hmB}{\mathnormal{B}}
\newmathzop{\hmH}{\mathnormal{H}}

\newmathzop{\hmrS}{\tl{\mathnormal{S}}}
\newmathzop{\hmrZ}{\tl{\mathnormal{Z}}}
\newmathzop{\hmrB}{\tl{\mathnormal{B}}}
\newmathzop{\hmrH}{\tl{\mathnormal{H}}}

% POIncare group
\newmathzop[1]{\poi}{\pi} 
\newmathzop[1]{\Poi}{\Pi}

\newmathzop*{\chS}{\mathnormal{S}}
\newmathzop*{\chZ}{\mathnormal{Z}}
\newmathzop*{\chB}{\mathnormal{B}}
\newmathzop*{\chH}{\mathnormal{H}}

\newmathzop[]{\Sin}{Sin}
\newmathzop*[]{\coSin}{Sin}
 
%% Analysis %% 
 
% this defines what dx actually looks like %
\newcommand{\diff}{\mathrm{\mathstrut d}}
 
% low-level tex for dx, via ISO-31 %
\providecommand*{\rawdiff}{\@ifnextchar^{\DIfF}{\DIfF^{}}}
\def\DIfF^#1{\mathop{\diff}\nolimits^{#1}\gobblespace}
\def\gobblespace{\futurelet\diffarg\opspace}
\def\opspace{
    \let\DiffSpace\!
    \ifx\diffarg(
        \let\DiffSpace\relax
    \else
        \ifx\diffarg[
            \let\DiffSpace\relax
        \else
            \ifx\diffarg\{
                \let\DiffSpace\relax
            \fi
        \fi
    \fi
    \DiffSpace
}
% %
 
\newcommand{\D}{\rawdiff}
\newcommand{\DD}{\mathrm{D}}
\newcommand{\del}{\partial}

% \leib[2]{d}{f}{x} -> (d^2 f)/dx^2
\providecommand*{\leib}[4][]{\frac{#2^{#1}#3}{#2 #4^{#1}}}

\newcommand{\od}[3][]{\leib[#1]{\D}{#2}{#3}}
\newcommand{\Dd}[3][]{\leib[#1]{\DD}{#2}{#3}}
\newcommand{\pd}[3][]{\leib[#1]{\del}{#2}{#3}}

\newcommand{\Dx}{{\D x}}
\newcommand{\Dy}{{\D y}}
\newcommand{\Dt}{{\D t}}

\newcommand{\cnt}{\CC} % function ranks, e.g. \cnt^0 -> continuous functions
\newcommand{\rie}{\LR} % riemann integrable funcs
\newcommand{\lbe}{\CL} % lebesgue integrable funcs

\newcommand{\Nd}[2]{#2^{\Par{#1}}}
\newmathzop{\res}{res}

\let\@iint\varoiint
\let\varoiint\oiint
\let\oiint\@iint
 
%% Vect Calc %%
\newmathop{\grad}{grad}
\newmathop{\dive}{div}
\newmathop{\curl}{curl}

\newmathop{\Grad}{\vnabla}
\newmathop{\Dive}{\vnabla\cdot}
\newmathop{\Curl}{\vnabla\times}
\newmathop{\laplace}{\vnabla^2}

%% Wordz %%
\newcommand{\newword}{\@ifstar\@newwordstar\@newword}

\newcommand{\@newwordstar}[2]{\newcommand{#1}{\quad\mathrel{\mathrm{#2}}\quad}}
\newcommand{\@newword}[2]{\newcommand{#1}{\mathrel{\mathrm{#2}}}}

\newword{\AND}{and}
\newword{\OR}{or}
\newword{\XOR}{xor}
\newword{\IF}{if}
\newword{\IFF}{iff}
\newword{\ST}{s.t.}
\newword{\OTHER}{otherwise}
\newword{\UNLESS}{unless}
\newword{\ELSE}{else}
\newword{\IN}{in}
\newword{\FOR}{for}

\newword*{\qAND}{and}
\newword*{\qOR}{or}

%% Misc %%
\renewcommand{\to}{\rightarrow}
\newcommand{\To}{\Rightarrow}
\newcommand{\Tto}{\Rrightarrow}
\newcommand{\toto}{\rightrightarrows}
\newcommand{\from}{\leftarrow}
\newcommand{\From}{\Leftarrow}
\newcommand{\Ffrom}{\Lleftarrow}
\newcommand{\fromfrom}{\leftleftarrows}
\newcommand{\fromto}{\texor@delim@basearrow}
\newcommand{\FromTo}{\texor@delim@basearrow}
\newcommand{\up}{\uparrow}
\newcommand{\upup}{\upuparrows}
\newcommand{\down}{\downarrow}
\newcommand{\downdown}{\downdownarrows}
\newcommand{\toself}{\circlearrowright}
\newcommand{\inj}{\hookrightarrow}
\newcommand{\srj}{\rightarrow\!\!\!\!\!\!\!\rightarrow}
\newcommand{\nato}{\rmap{\hstretch{2}{\vstretch{2}{.}}}}
\newcommand{\adj}{\rightharpoonup}
\newcommand{\acts}{\curvearrowright}
\newcommand{\acted}{\curvearrowleft}

\newcommand{\FirstWay}{\noindent($\Rightarrow$). }
\newcommand{\OtherWay}{\noindent($\Leftarrow$). }
\newcommand{\NWay}[2]{\noindent(#1) $\Leftarrow$ (#2). }

\newcommand{\nto}{\not\to}
\newcommand{\@ide}{\mathrm{id}}
\newcommand{\ide}[1][]{\texor@exists{#1}{\@ide_{#1}}{\@ide}}

\newcommand{\rmap}[1]{\xrightarrow{#1}}
\newcommand{\lmap}[1]{\xleftarrow{#1}}

\newmathop{\erf}{erf}

\newcommand{\nin}{\notin}
\newcommand{\subS}{\sbs}
\newcommand{\supS}{\sps}
\newcommand{\sbs}{\subset}
\newcommand{\sps}{\supset}
\newcommand{\nsubS}{\nsbs}
\newcommand{\nsupS}{\nsps}
\newcommand{\nsbs}{\subsetneq}
\newcommand{\nsps}{\supsetneq}
\newcommand{\sans}[1][]{\setminus\texor@exists{#1}{\Cur{#1}}{}}
\newcommand{\sansz}{\sans[0]}

\newcommand{\@setminus@t}
    {\hbox{\tikz{\draw[line width=0.6pt,line cap=round] (3pt,0) -- (0,5pt);}}}
\newcommand{\@setminus@s}
    {\hbox{\tikz{\draw[line width=0.45pt,line cap=round] (2pt,0) -- (0,4pt);}}}
\newcommand{\@setminus@ss}
    {\hbox{\tikz{\draw[line width=0.4pt,line cap=round] (1.5pt,0) -- (0,3pt);}}}

\let\bigsetminus\setminus
\renewcommand{\setminus}
    {\mathbin{\mathchoice{\@setminus@t}{\@setminus@t}{\@setminus@s}{\@setminus@ss}}}

\let\@cong\cong
\newcommand{\ind}{\fld{1}}
\newcommand{\isom}{\@cong}
\newcommand{\homeo}{\@cong}
\newcommand{\htpy}{\simeq}
\renewcommand{\cong}{\equiv}
\newcommand{\isdef}{:=}

\newcommand{\ov}{\overline}
\newcommand{\un}{\underline}
\newcommand{\tl}{\tilde}

\newcommand{\jacobi}[2]{\Par{\frac{#1}{#2}}}

%% Physics %%

\newcommand{\KE}{K\hspace{-0.6ex}E}
\newcommand{\rA}{\text{\normalfont\AA}}

\def\labar{\protect\texor@font@lambdabar}
\def\texor@font@lambdabar{%
\relax
\bgroup
\def\@tempa{\hbox{\raise.8\ht0
\hbox to0pt{\kern.15\wd0\vrule width.65\wd0
height.25pt depth.1pt\hss}\box0}}% 
\mathchoice{\setbox0\hbox{$\displaystyle\lambda$}\@tempa}%
{\setbox0\hbox{$\textstyle\lambda$}\@tempa}%
{\setbox0\hbox{$\scriptstyle\lambda$}\@tempa}%
{\setbox0\hbox{$\scriptscriptstyle\lambda$}\@tempa}%
\egroup
}

\def\ham{{\hat{\CH}}}

%% SI Inits %

\sisetup{
    inter-unit-product = \ensuremath{{}\cdot{}}
}

%%% Pset templating %%%
%% TODO: make this a class

\newcommand{\psetSubject}[1]{\def\texor@pset@subject{#1}}
\def\texor@pset@subject{undefined}

\newcommand{\psetAuthor}[1]{\def\texor@pset@author{#1}}
\def\texor@pset@author{Miguel Young}

\newcommand{\psetNum}[1]{\def\texor@pset@num{#1}}
\def\texor@pset@num{undefined}

\newcommand{\psetCollabs}[1]{\def\texor@pset@collabs{Collaborators: #1}}
\def\texor@pset@collabs{}

\newcommand{\psetSources}[1]{\def\texor@pset@sources{Sources: #1}}
\def\texor@pset@sources{}

\newcommand{\psetTitle}[1]{%
    \newpage
    \begin{center}
        \makeatletter
        {\huge \texor@pset@subject{} Pset \texor@pset@num{} #1 }

        {\large \texor@pset@author}

        \ifthenelse{\equal{\texor@pset@collabs}{}}{}{Collaborators: \texor@pset@collabs}
        
        \ifthenelse{\equal{\texor@pset@sources}{}}{}{Sources: \texor@pset@sources}
        \makeatother
    \end{center}
}

\newcommand{\makePsetTitle}{\psetTitle{}}
\newcommand{\mkPsetTitle}{\makePsetTitle}

\newcommand{\makepsettitle}{%
    \makeatletter%
    \title{\texor@pset@subject{} Pset \texor@pset@num{}\texor@exists{\texor@pset@sources}{\footnote{\texor@pset@sources}}{}}%
    \author{\texor@pset@author\texor@exists{\texor@pset@collabs}{\footnote{\texor@pset@collabs}}{}}%
    \maketitle%
    \makeatother%
}

\newcounter{texor@pset@ProblemCounter}
\setcounter{texor@pset@ProblemCounter}{0}
\newenvironment{psetProblem}{%
    \makeatletter
    \stepcounter{texor@pset@ProblemCounter}
    \psetTitle{Problem \arabic{texor@pset@ProblemCounter}}
    \makeatother
}{}

%%% Matrices %%%
%% Square %%

\newcommand{\texor@exists@phantom}[1]{\texor@exists{#1}{#1}{\hphantom{0}}}

\newcommand{\bsing}[1]{
    \begin{bmatrix}
        \texor@exists@phantom{#1}
    \end{bmatrix}
}

\newcommand{\btwo}[4]{%
    \begin{bmatrix}
        \texor@exists@phantom{#1} & \texor@exists@phantom{#2} \\ 
        #3 & #4 \\
    \end{bmatrix}
}

\newcommand{\bthree}[9]{%
    \begin{bmatrix}
        \texor@exists@phantom{#1} & \texor@exists@phantom{#2} & \texor@exists@phantom{#3} \\ 
        #4 & #5 & #6 \\
        #7 & #8 & #9 \\
    \end{bmatrix}
}

\newcommand{\Vbtwo}[2]{%
    \begin{bmatrix}
        \texor@exists@phantom{#1} \\ #2 \\
    \end{bmatrix}
}

\newcommand{\Hbtwo}[2]{%
    \begin{bmatrix}
        \texor@exists@phantom{#1} & \texor@exists@phantom{#2}
    \end{bmatrix}
}

\newcommand{\Vbthree}[3]{%
    \begin{bmatrix}
        \texor@exists@phantom{#1} \\ #2 \\ #3 \\
    \end{bmatrix}
}



\newcommand{\Hbthree}[3]{%
    \begin{bmatrix}
        \texor@exists@phantom{#1} & \texor@exists@phantom{#2} & \texor@exists@phantom{#3}
    \end{bmatrix}
}

\newcommand{\bdtwo}[2]{\btwo{#1}{}{}{#2}}
\newcommand{\bdthree}[3]{\bthree{#1}{}{}{}{#2}{}{}{}{#3}}

%% Round %%

\newcommand{\psing}[1]{
    \begin{pmatrix}
        \texor@exists@phantom{#1}
    \end{pmatrix}
}

\newcommand{\ptwo}[4]{%
    \begin{pmatrix}
        \texor@exists@phantom{#1} & \texor@exists@phantom{#2} \\ 
        #3 & #4 \\
    \end{pmatrix}
}

\newcommand{\pthree}[9]{%
    \begin{pmatrix}
        \texor@exists@phantom{#1} & \texor@exists@phantom{#2} & \texor@exists@phantom{#3} \\ 
        #4 & #5 & #6 \\
        #7 & #8 & #9 \\
    \end{pmatrix}
}

\newcommand{\Vptwo}[2]{%
    \begin{pmatrix}
        \texor@exists@phantom{#1} \\ #2 \\
    \end{pmatrix}
}

\newcommand{\Hptwo}[2]{%
    \begin{pmatrix}
        \texor@exists@phantom{#1} & \texor@exists@phantom{#2}
    \end{pmatrix}
}
\newcommand{\Vpthree}[3]{%
    \begin{pmatrix}
        \texor@exists@phantom{#1} \\ #2 \\ #3 \\
    \end{pmatrix}
}

\newcommand{\Hpthree}[3]{%
    \begin{pmatrix}
        \texor@exists@phantom{#1} & \texor@exists@phantom{#2} & \texor@exists@phantom{#3}
    \end{pmatrix}
}

\newcommand{\pdtwo}[2]{\ptwo{#1}{}{}{#2}}
\newcommand{\pdthree}[3]{\pthree{#1}{}{}{}{#2}{}{}{}{#3}}

%% Vert %%

\newcommand{\vsing}[1]{
    \begin{vmatrix}
        \texor@exists@phantom{#1}
    \end{vmatrix}
}

\newcommand{\Vtwo}[4]{%
    \begin{vmatrix}
        \texor@exists@phantom{#1} & \texor@exists@phantom{#2} \\ 
        #3 & #4 \\
    \end{vmatrix}
}

\newcommand{\Vthree}[9]{%
    \begin{vmatrix}
        \texor@exists@phantom{#1} & \texor@exists@phantom{#2} & \texor@exists@phantom{#3} \\ 
        #4 & #5 & #6 \\
        #7 & #8 & #9 \\
    \end{vmatrix}
}

\newcommand{\VVtwo}[2]{%
    \begin{vmatrix}
        \texor@exists@phantom{#1} \\ #2 \\
    \end{vmatrix}
}

\newcommand{\HVtwo}[2]{%
    \begin{vmatrix}
        \texor@exists@phantom{#1} & \texor@exists@phantom{#2}
    \end{vmatrix}
}
\newcommand{\VVthree}[3]{%
    \begin{vmatrix}
        \texor@exists@phantom{#1} \\ #2 \\ #3 \\
    \end{vmatrix}
}

\newcommand{\HVthree}[3]{%
    \begin{vmatrix}
        \texor@exists@phantom{#1} & \texor@exists@phantom{#2} & \texor@exists@phantom{#3}
    \end{vmatrix}
}

\newcommand{\Vdtwo}[2]{\Vtwo{#1}{}{}{#2}}
\newcommand{\Vdthree}[3]{\Vthree{#1}{}{}{}{#2}{}{}{}{#3}}

%%% Linguistics %%%

%% IPA %%
\newcommand{\tp}{\textipa}

\newcommand{\snd}[1]{\textipa{[#1]}}
\newcommand{\phn}[1]{\textipa{/#1/}}
\newcommand{\grh}[1]{$\langle$#1$\rangle$}
\newcommand{\tpgrh}[1]{\grh{\textipa{#1}}}

\newcommand{\gn}{\textltailn}

\newcommand{\@has}[4][-]{\texor@exists{#1}{{\texor@exists{#2}{[#3#2]}{#4}}}{\hasbrack{#2}}}
\newcommand{\withc}[2][-]{\@has[#1]{#2}{$+$}{[ ]}}
\newcommand{\sansc}[2][-]{\@has[#1]{#2}{$-$}{$\eset$}}
\newcommand{\phrule}[4]{{#1 $\to$ #2\texor@exists{#3#4}{ / \texor@exists{#3}{#3 }{}\_\texor@exists{#4}{ #4}{}}{}}}
\newcommand{\hasbrack}[1]{%
\begingroup%
\renewcommand{\withc}[2][-]{$+$##2}%
\renewcommand{\sansc}[2][-]{$-$##2}%
\renewcommand{\actv}[1]{$\al$ ##1}%
[#1]%
\endgroup%
}

\newcommand{\has}{\@ifstar\sansc\withc}
\newcommand{\actv}[1]{[$\al$ #1]}

%% Phonology %%
\newcommand{\plus}{$+$}
\newcommand{\minus}{$-$}
\newcommand{\into}{$\to$ }
\newcommand{\blank}{$\underline{\quad}$ }
\newcommand{\zero}{$\varnothing$ }

%%% OPTIONS %%%
\newcommand{\checkfor}[2]{%
    \ifcsname#1\endcsname%
        #2%
    \fi%
}
\DeclareOption{shortST}{%
    \def\ST{\,\mathrm{s.t.}\,}
}
\DeclareOption{vec}{
    \usevec
}
\DeclareOption{veca}{
    \useveca
}
\ProcessOptions\relax
%%% OPTIONS %%%

\endinput
%%
%% End of file `xor.sty'.
